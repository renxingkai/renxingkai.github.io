<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Docker基础学习"><meta name="keywords" content="docker"><meta name="author" content="CinKate"><meta name="copyright" content="CinKate"><title>Docker基础学习 | CinKate's Blogs</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://hm.baidu.com"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?b77222dd6b9929f160b8a04fc8705337";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '3.9.0'
} </script></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker的常用命令"><span class="toc-number">1.</span> <span class="toc-text">Docker的常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#帮助命令"><span class="toc-number">1.1.</span> <span class="toc-text">帮助命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#镜像命令"><span class="toc-number">1.2.</span> <span class="toc-text">镜像命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#docker-images-查看所有本地主机上的镜像"><span class="toc-number">1.2.1.</span> <span class="toc-text">docker images #查看所有本地主机上的镜像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#docker-search-搜索镜像"><span class="toc-number">1.2.2.</span> <span class="toc-text">docker search #搜索镜像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#docker-pull-下载镜像"><span class="toc-number">1.2.3.</span> <span class="toc-text">docker pull #下载镜像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#docker-rmi-删除镜像"><span class="toc-number">1.2.4.</span> <span class="toc-text">docker rmi  #删除镜像</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#容器命令"><span class="toc-number">2.</span> <span class="toc-text">容器命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#常用其他命令"><span class="toc-number">3.</span> <span class="toc-text">常用其他命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Test1-Docker部属nginx"><span class="toc-number">4.</span> <span class="toc-text">Test1-Docker部属nginx</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Test2-Docker部属tomcat"><span class="toc-number">5.</span> <span class="toc-text">Test2-Docker部属tomcat</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Test3-Docker部属ES-kibana"><span class="toc-number">6.</span> <span class="toc-text">Test3-Docker部属ES+kibana</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#可视化"><span class="toc-number">7.</span> <span class="toc-text">可视化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#commit镜像"><span class="toc-number">8.</span> <span class="toc-text">commit镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker容器数据卷"><span class="toc-number">9.</span> <span class="toc-text">docker容器数据卷</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#使用数据卷"><span class="toc-number">9.1.</span> <span class="toc-text">使用数据卷</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Test4–安装MySQL"><span class="toc-number">10.</span> <span class="toc-text">Test4–安装MySQL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#具名和匿名挂载"><span class="toc-number">11.</span> <span class="toc-text">具名和匿名挂载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#初始Dockerfile"><span class="toc-number">12.</span> <span class="toc-text">初始Dockerfile</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数据卷容器"><span class="toc-number">13.</span> <span class="toc-text">数据卷容器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DockerFile"><span class="toc-number">14.</span> <span class="toc-text">DockerFile</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DockerFile的构建过程"><span class="toc-number">15.</span> <span class="toc-text">DockerFile的构建过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DockerFile的指令"><span class="toc-number">16.</span> <span class="toc-text">DockerFile的指令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#构建自己的centos"><span class="toc-number">17.</span> <span class="toc-text">构建自己的centos</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实战：Dockerfile制作tomcat镜像"><span class="toc-number">18.</span> <span class="toc-text">实战：Dockerfile制作tomcat镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker0网络详解"><span class="toc-number">19.</span> <span class="toc-text">Docker0网络详解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-–link-容器互联"><span class="toc-number">20.</span> <span class="toc-text">Docker –link 容器互联</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker自定义网络"><span class="toc-number">21.</span> <span class="toc-text">Docker自定义网络</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#网络连通"><span class="toc-number">22.</span> <span class="toc-text">网络连通</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis集群实战"><span class="toc-number">23.</span> <span class="toc-text">Redis集群实战</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="http://imgsrc.baidu.com/forum/w%3D580/sign=f8de0e9b3e87e9504217f3642039531b/1c3bd133c895d143e395e57b77f082025baf0726.jpg"></div><div class="author-info__name text-center">CinKate</div><div class="author-info__description text-center">长笛一声人倚楼~</div><div class="follow-button"><a href="https://github.com/renxingkai">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">51</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">32</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">17</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(http://p17.qhimg.com/d/_open360/fengjing0403/21.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">CinKate's Blogs</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a><a class="site-page" href="/about">About</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">Docker基础学习</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-12-22</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/后台学习/">后台学习</a><div class="post-meta-wordcount"><span>Word count: </span><span class="word-count">10.9k</span><span class="post-meta__separator">|</span><span>Reading time: 59 min</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="Docker的常用命令"><a href="#Docker的常用命令" class="headerlink" title="Docker的常用命令"></a>Docker的常用命令</h2><h3 id="帮助命令"><a href="#帮助命令" class="headerlink" title="帮助命令"></a>帮助命令</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker version #显示docker的版本信息</span><br><span class="line">docker info #显示docker的系统信息，包括镜像和容器的数量</span><br><span class="line">docker 命令 --help #帮助命令</span><br></pre></td></tr></table></figure>
<p>帮助文档的地址：<br><a href="https://docs.docker.com/engine/reference/commandline/docker/" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/docker/</a></p>
<h3 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h3><h4 id="docker-images-查看所有本地主机上的镜像"><a href="#docker-images-查看所有本地主机上的镜像" class="headerlink" title="docker images #查看所有本地主机上的镜像"></a>docker images #查看所有本地主机上的镜像</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker images #查看所有本地主机上的镜像</span><br><span class="line"></span><br><span class="line">[root@VM-0-15-centos ~]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">hello-world         latest              bf756fb1ae65        11 months ago       13.3kB</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>解释</span><br><span class="line">REPOSITORY  #镜像的仓库</span><br><span class="line">TAG  #镜像的标签</span><br><span class="line">IMAGE ID  #镜像的ID</span><br><span class="line">CREATED  #镜像的创建时间</span><br><span class="line">SIZE  #镜像的大小</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>可选项</span><br><span class="line">Options:</span><br><span class="line">  -a, --all             #列出所有镜像</span><br><span class="line">      --digests         Show digests</span><br><span class="line">  -q, --quiet           #仅显示镜像的ID</span><br></pre></td></tr></table></figure>
<h4 id="docker-search-搜索镜像"><a href="#docker-search-搜索镜像" class="headerlink" title="docker search #搜索镜像"></a>docker search #搜索镜像</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@VM-0-15-centos ~]# docker search tensorflow</span><br><span class="line">NAME                                       DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED</span><br><span class="line">tensorflow/tensorflow                      Official Docker images for the machine learn…   1799                                    </span><br><span class="line">jupyter/tensorflow-notebook                Jupyter Notebook Scientific Python Stack w/ …   248                                     </span><br><span class="line">tensorflow/serving                         Official images for TensorFlow Serving (http…   102                                     </span><br><span class="line">rocm/tensorflow                            Tensorflow with ROCm backend support            58                                      </span><br><span class="line">xblaster/tensorflow-jupyter                Dockerized Jupyter with tensorflow              54                                      [OK]</span><br><span class="line">floydhub/tensorflow                        tensorflow                                      26                                      [OK]</span><br><span class="line">bitnami/tensorflow-serving                 Bitnami Docker Image for TensorFlow Serving     14                                      [OK]</span><br><span class="line">opensciencegrid/tensorflow-gpu             TensorFlow GPU set up for OSG                   12</span><br></pre></td></tr></table></figure>
<h4 id="docker-pull-下载镜像"><a href="#docker-pull-下载镜像" class="headerlink" title="docker pull #下载镜像"></a>docker pull #下载镜像</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#docker pull mysql 镜像名[:tag]</span><br><span class="line"></span><br><span class="line">[root@VM-0-15-centos ~]# docker pull mysql</span><br><span class="line">Using default tag: latest #不写tag，默认latest</span><br><span class="line">latest: Pulling from library/mysql</span><br><span class="line">852e50cd189d: Pull complete  #分层下载,docker 镜像的核心 联合文件系统</span><br><span class="line">29969ddb0ffb: Pull complete </span><br><span class="line">a43f41a44c48: Pull complete </span><br><span class="line">5cdd802543a3: Pull complete </span><br><span class="line">b79b040de953: Pull complete </span><br><span class="line">938c64119969: Pull complete </span><br><span class="line">7689ec51a0d9: Pull complete </span><br><span class="line">a880ba7c411f: Pull complete </span><br><span class="line">984f656ec6ca: Pull complete </span><br><span class="line">9f497bce458a: Pull complete </span><br><span class="line">b9940f97694b: Pull complete </span><br><span class="line">2f069358dc96: Pull complete </span><br><span class="line">Digest: sha256:4bb2e81a40e9d0d59bd8e3dc2ba5e1f2197696f6de39a91e90798dd27299b093 #签名</span><br><span class="line">Status: Downloaded newer image for mysql:latest</span><br><span class="line">docker.io/library/mysql:latest #真实地址</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#指定版本</span><br><span class="line">docker pull mysql:5.7</span><br><span class="line"></span><br><span class="line">[root@VM-0-15-centos ~]# docker pull mysql:5.7</span><br><span class="line">5.7: Pulling from library/mysql</span><br><span class="line">852e50cd189d: Already exists </span><br><span class="line">29969ddb0ffb: Already exists </span><br><span class="line">a43f41a44c48: Already exists </span><br><span class="line">5cdd802543a3: Already exists </span><br><span class="line">b79b040de953: Already exists </span><br><span class="line">938c64119969: Already exists </span><br><span class="line">7689ec51a0d9: Already exists </span><br><span class="line">36bd6224d58f: Pull complete </span><br><span class="line">cab9d3fa4c8c: Pull complete </span><br><span class="line">1b741e1c47de: Pull complete </span><br><span class="line">aac9d11987ac: Pull complete </span><br><span class="line">Digest: sha256:8e2004f9fe43df06c3030090f593021a5f283d028b5ed5765cc24236c2c4d88e</span><br><span class="line">Status: Downloaded newer image for mysql:5.7</span><br><span class="line">docker.io/library/mysql:5.7</span><br></pre></td></tr></table></figure>
<h4 id="docker-rmi-删除镜像"><a href="#docker-rmi-删除镜像" class="headerlink" title="docker rmi  #删除镜像"></a>docker rmi  #删除镜像</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span>按docker id镜像删除</span><br><span class="line">[root@VM-0-15-centos ~]# docker rmi -f ae0658fdbad5  </span><br><span class="line">Untagged: mysql:5.7</span><br><span class="line">Untagged: mysql@sha256:8e2004f9fe43df06c3030090f593021a5f283d028b5ed5765cc24236c2c4d88e</span><br><span class="line">Deleted: sha256:ae0658fdbad5fb1c9413c998d8a573eeb5d16713463992005029c591e6400d02</span><br><span class="line">Deleted: sha256:a2cf831f4221764f4484ff0df961b54f1f949ed78220de1b24046843c55ac40f</span><br><span class="line">Deleted: sha256:0a7adcc95a91b1ec2beab283e0bfce5ccd6df590bd5a5e894954fcf27571e7f5</span><br><span class="line">Deleted: sha256:0fae465cbacf7c99aa90bc286689bc88a35d086f37fd931e03966d312d5dfb10</span><br><span class="line">Deleted: sha256:23af125b9e54a94c064bdfacc2414b1c8fba288aff48308e8117beb08b38cb19</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>递归删除所有的镜像</span><br><span class="line">[root@VM-0-15-centos ~]# docker rmi -f $(docker images -aq)</span><br><span class="line">Untagged: mysql:latest</span><br><span class="line">Untagged: mysql@sha256:4bb2e81a40e9d0d59bd8e3dc2ba5e1f2197696f6de39a91e90798dd27299b093</span><br><span class="line">Deleted: sha256:dd7265748b5dc3211208fb9aa232cef8d3fefd5d9a2a80d87407b8ea649e571c</span><br><span class="line">Deleted: sha256:aac9a624212bf416c3b41a62212caf12ed3c578d6b17b0f15be13a7dab56628d</span><br><span class="line">Deleted: sha256:1bf3ce09276e9e128108b166121e5d04abd16e7de7473b53b3018c6db0cf23ff</span><br><span class="line">Deleted: sha256:24c6444cea460c3cc2f4e0385e3e97819a0672a54a361921f95d4582583abd59</span><br><span class="line">Deleted: sha256:77585ebe3eaa035694084b3c5937fe82b8972aae1e6c6070fc4d7bc391d10928</span><br><span class="line">Deleted: sha256:1cfd539163ceb17f7bb85a0da968714fe9258b75dbf73f5ad45392a45cfd34b7</span><br><span class="line">Deleted: sha256:c37f414ac8d2b5e5d39f159a6dffd30b279c1268f30186cee5da721e451726ea</span><br><span class="line">Deleted: sha256:955b3c214bccf3ee2a7930768137fd7ed6a72677334be67a07c78a622abd318a</span><br><span class="line">Deleted: sha256:a2e35a0fdb20100365e2fb26c65357fcf926ac7990bf9074a51cbac5a8358d7e</span><br><span class="line">Deleted: sha256:8c3a028fc66f360ce6ce6c206786df68fac4c24257474cbe4f67eda0ac21efd6</span><br><span class="line">Deleted: sha256:0a6d37fabaceb4faa555e729a7d97cb6ee193cb97789a213907a3d3c156d7e35</span><br><span class="line">Deleted: sha256:579519c51de1afe1e29d284b1741af239a307975197cf6ce213a70068d923231</span><br><span class="line">Deleted: sha256:f5600c6330da7bb112776ba067a32a9c20842d6ecc8ee3289f1a713b644092f8</span><br><span class="line">Untagged: hello-world:latest</span><br><span class="line">Untagged: hello-world@sha256:e7c70bb24b462baa86c102610182e3efcb12a04854e8c582838d92970a09f323</span><br><span class="line">Deleted: sha256:bf756fb1ae65adf866bd8c456593cd24beb6a0a061dedf42b26a993176745f6b</span><br></pre></td></tr></table></figure>
<h2 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h2><p><strong>有了镜像才能创建容器，linux，下载一个centos镜像来测试</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@VM-0-15-centos ~]# docker pull centos</span><br></pre></td></tr></table></figure>
<p><strong>新建容器并启动</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker run [可选参数] image</span><br><span class="line"></span><br><span class="line">#参数说明</span><br><span class="line">--name=&quot;Name&quot;  #容器名字</span><br><span class="line">-d   #使用后台方式运行，类似nohup</span><br><span class="line">-it  #使用交互方式运行，进入容器查看内容</span><br><span class="line">-p   #指定容器端口  -p 8080:8080</span><br><span class="line">    -p 主机端口:容器端口 (常用)</span><br><span class="line">    -p 容器端口</span><br><span class="line">    容器端口</span><br><span class="line">-P   #随机指定端口</span><br></pre></td></tr></table></figure>
<p><strong>启动并进入容器</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@VM-0-15-centos ~]# docker run -it centos /bin/bash</span><br><span class="line">[root@1faa1a0b849e /]# </span><br><span class="line">[root@1faa1a0b849e /]# ls</span><br><span class="line">bin  etc   lib	  lost+found  mnt  proc  run   srv  tmp  var</span><br><span class="line">dev  home  lib64  media       opt  root  sbin  sys  usr</span><br><span class="line">#退出容器</span><br><span class="line">[root@1faa1a0b849e /]# exit</span><br><span class="line">exit</span><br><span class="line">[root@VM-0-15-centos ~]# ls</span><br></pre></td></tr></table></figure>
<p><strong>列出所有运行中的容器</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#列出当前在运行的容器</span><br><span class="line">[root@VM-0-15-centos ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">#列出所有运行过的容器</span><br><span class="line">[root@VM-0-15-centos ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                      PORTS               NAMES</span><br><span class="line">1faa1a0b849e        centos              &quot;/bin/bash&quot;         4 minutes ago       Exited (0) 55 seconds ago                       frosty_cori</span><br><span class="line">0d482f3a4d60        bf756fb1ae65        &quot;/hello&quot;            34 hours ago        Exited (0) 34 hours ago                         nifty_visvesvaraya</span><br><span class="line">e05f6bfe06e0        bf756fb1ae65        &quot;/hello&quot;            34 hours ago        Exited (0) 34 hours ago                         amazing_diffie</span><br><span class="line">8a40e14a2c36        bf756fb1ae65        &quot;/hello&quot;            34 hours ago        Exited (0) 34 hours ago                         goofy_liskov</span><br><span class="line"></span><br><span class="line">#列出最近创建的容器</span><br><span class="line">[root@VM-0-15-centos ~]# docker ps -n=1</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                          PORTS               NAMES</span><br><span class="line">1faa1a0b849e        centos              &quot;/bin/bash&quot;         5 minutes ago       Exited (0) About a minute ago                       frosty_cori</span><br><span class="line"></span><br><span class="line">#只显示容器的编号</span><br><span class="line">[root@VM-0-15-centos ~]# docker ps -aq</span><br><span class="line">1faa1a0b849e</span><br><span class="line">0d482f3a4d60</span><br><span class="line">e05f6bfe06e0</span><br><span class="line">8a40e14a2c36</span><br></pre></td></tr></table></figure>
<p><strong>退出容器</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">exit  #直接容器停止并退出</span><br><span class="line">CTRL+P+Q  #容器不停止并退出</span><br><span class="line"></span><br><span class="line">[root@VM-0-15-centos ~]# docker run -it centos /bin/bash</span><br><span class="line">[root@e5a4a59f28ff /]# [root@VM-0-15-centos ~]# </span><br><span class="line">[root@VM-0-15-centos ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">e5a4a59f28ff        centos              &quot;/bin/bash&quot;         21 seconds ago      Up 20 seconds                           agitated_ritchie</span><br></pre></td></tr></table></figure>
<p><strong>删除容器</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker rm 容器id  #删除指定的容器,不能删除正在运行的容器，如要删除，加-f</span><br><span class="line">#递归删除所有docker容器</span><br><span class="line">docker rm -f $(docker ps -aq)  </span><br><span class="line">#删除所有容器</span><br><span class="line">docker ps -a -q|xargs docker rm</span><br><span class="line"></span><br><span class="line">[root@VM-0-15-centos ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                      PORTS               NAMES</span><br><span class="line">e5a4a59f28ff        centos              &quot;/bin/bash&quot;         5 minutes ago       Up 5 minutes                                    agitated_ritchie</span><br><span class="line">c4fd9794c39a        centos              &quot;/bin/bash&quot;         5 minutes ago       Exited (0) 5 minutes ago                        dreamy_lumiere</span><br><span class="line">1faa1a0b849e        centos              &quot;/bin/bash&quot;         16 minutes ago      Exited (0) 12 minutes ago                       frosty_cori</span><br><span class="line">0d482f3a4d60        bf756fb1ae65        &quot;/hello&quot;            34 hours ago        Exited (0) 34 hours ago                         nifty_visvesvaraya</span><br><span class="line">e05f6bfe06e0        bf756fb1ae65        &quot;/hello&quot;            34 hours ago        Exited (0) 34 hours ago                         amazing_diffie</span><br><span class="line">8a40e14a2c36        bf756fb1ae65        &quot;/hello&quot;            34 hours ago        Exited (0) 34 hours ago                         goofy_liskov</span><br><span class="line">[root@VM-0-15-centos ~]# docker rm e5a4a59f28ff</span><br><span class="line">Error response from daemon: You cannot remove a running container e5a4a59f28ffc678ab9ea5ed7a9af825ff053e1816cd94c90880b3d2a87997df. Stop the container before attempting removal or force remove</span><br><span class="line">[root@VM-0-15-centos ~]# docker rm -f $(docker ps -aq)</span><br><span class="line">e5a4a59f28ff</span><br><span class="line">c4fd9794c39a</span><br><span class="line">1faa1a0b849e</span><br><span class="line">0d482f3a4d60</span><br><span class="line">e05f6bfe06e0</span><br><span class="line">8a40e14a2c36</span><br><span class="line">[root@VM-0-15-centos ~]# docker ps -aq</span><br><span class="line">[root@VM-0-15-centos ~]#</span><br></pre></td></tr></table></figure>
<p><strong>启动和停止容器的操作</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker start 容器id #启动 </span><br><span class="line">docker restart 容器id #重启</span><br><span class="line">docker stop 容器id #停止当前运行的容器</span><br><span class="line">docker kill 容器id #强制停止当前容器</span><br></pre></td></tr></table></figure>
<h2 id="常用其他命令"><a href="#常用其他命令" class="headerlink" title="常用其他命令"></a>常用其他命令</h2><p><strong>后台启动容器</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker run -d centos #后台启动 </span><br><span class="line">#docker ps 时候，发现centos会停止，因为容器后台运行，就必须要一个前台进程，docker发现没有应用，就会自动停止</span><br></pre></td></tr></table></figure>
<p><strong>查看日志</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker logs -f -t --tail 10  容器id #发现没有日志</span><br></pre></td></tr></table></figure>
<p><strong>查看容器中的进程信息</strong></p>
<p><strong>docker top 容器id</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@VM-0-15-centos ~]# docker run -it centos /bin/bash</span><br><span class="line">[root@ba393184f315 /]# [root@VM-0-15-centos ~]# </span><br><span class="line">[root@VM-0-15-centos ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">ba393184f315        centos              &quot;/bin/bash&quot;         9 seconds ago       Up 8 seconds                            wizardly_cerf</span><br><span class="line">[root@VM-0-15-centos ~]# docker top ba393184f315</span><br><span class="line">UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD</span><br><span class="line">root                25856               25840               0                   09:46               pts/0               00:00:00            /bin/bash</span><br></pre></td></tr></table></figure>
<p><strong>查看镜像的元数据</strong></p>
<p><strong>docker inspect 容器id</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@VM-0-15-centos ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">ba393184f315        centos              &quot;/bin/bash&quot;         3 minutes ago       Up 3 minutes                            wizardly_cerf</span><br><span class="line">[root@VM-0-15-centos ~]# docker inspect ba393184f315</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Id&quot;: &quot;ba393184f3157b86b24aa040b24b4e169c3d1aed0ca56edee01596a7f833fd73&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2020-12-01T01:46:02.700180427Z&quot;,</span><br><span class="line">        &quot;Path&quot;: &quot;/bin/bash&quot;,</span><br><span class="line">        &quot;Args&quot;: [],</span><br><span class="line">        &quot;State&quot;: &#123;</span><br><span class="line">            &quot;Status&quot;: &quot;running&quot;,</span><br><span class="line">            &quot;Running&quot;: true,</span><br><span class="line">            &quot;Paused&quot;: false,</span><br><span class="line">            &quot;Restarting&quot;: false,</span><br><span class="line">            &quot;OOMKilled&quot;: false,</span><br><span class="line">            &quot;Dead&quot;: false,</span><br><span class="line">            &quot;Pid&quot;: 25856,</span><br><span class="line">            &quot;ExitCode&quot;: 0,</span><br><span class="line">            &quot;Error&quot;: &quot;&quot;,</span><br><span class="line">            &quot;StartedAt&quot;: &quot;2020-12-01T01:46:02.955068318Z&quot;,</span><br><span class="line">            &quot;FinishedAt&quot;: &quot;0001-01-01T00:00:00Z&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Image&quot;: &quot;sha256:0d120b6ccaa8c5e149176798b3501d4dd1885f961922497cd0abef155c869566&quot;,</span><br><span class="line">        &quot;ResolvConfPath&quot;: &quot;/var/lib/docker/containers/ba393184f3157b86b24aa040b24b4e169c3d1aed0ca56edee01596a7f833fd73/resolv.conf&quot;,</span><br><span class="line">        &quot;HostnamePath&quot;: &quot;/var/lib/docker/containers/ba393184f3157b86b24aa040b24b4e169c3d1aed0ca56edee01596a7f833fd73/hostname&quot;,</span><br><span class="line">        &quot;HostsPath&quot;: &quot;/var/lib/docker/containers/ba393184f3157b86b24aa040b24b4e169c3d1aed0ca56edee01596a7f833fd73/hosts&quot;,</span><br><span class="line">        &quot;LogPath&quot;: &quot;/var/lib/docker/containers/ba393184f3157b86b24aa040b24b4e169c3d1aed0ca56edee01596a7f833fd73/ba393184f3157b86b24aa040b24b4e169c3d1aed0ca56edee01596a7f833fd73-json.log&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;/wizardly_cerf&quot;,</span><br><span class="line">        &quot;RestartCount&quot;: 0,</span><br><span class="line">        &quot;Driver&quot;: &quot;overlay2&quot;,</span><br><span class="line">        &quot;Platform&quot;: &quot;linux&quot;,</span><br><span class="line">        &quot;MountLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ProcessLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;AppArmorProfile&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ExecIDs&quot;: null,</span><br><span class="line">        &quot;HostConfig&quot;: &#123;</span><br><span class="line">            &quot;Binds&quot;: null,</span><br><span class="line">            &quot;ContainerIDFile&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LogConfig&quot;: &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;json-file&quot;,</span><br><span class="line">                &quot;Config&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;NetworkMode&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;PortBindings&quot;: &#123;&#125;,</span><br><span class="line">            &quot;RestartPolicy&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;no&quot;,</span><br><span class="line">                &quot;MaximumRetryCount&quot;: 0</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;AutoRemove&quot;: false,</span><br><span class="line">            &quot;VolumeDriver&quot;: &quot;&quot;,</span><br><span class="line">            &quot;VolumesFrom&quot;: null,</span><br><span class="line">            &quot;CapAdd&quot;: null,</span><br><span class="line">            &quot;CapDrop&quot;: null,</span><br><span class="line">            &quot;Capabilities&quot;: null,</span><br><span class="line">            &quot;Dns&quot;: [],</span><br><span class="line">            &quot;DnsOptions&quot;: [],</span><br><span class="line">            &quot;DnsSearch&quot;: [],</span><br><span class="line">            &quot;ExtraHosts&quot;: null,</span><br><span class="line">            &quot;GroupAdd&quot;: null,</span><br><span class="line">            &quot;IpcMode&quot;: &quot;private&quot;,</span><br><span class="line">            &quot;Cgroup&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Links&quot;: null,</span><br><span class="line">            &quot;OomScoreAdj&quot;: 0,</span><br><span class="line">            &quot;PidMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Privileged&quot;: false,</span><br><span class="line">            &quot;PublishAllPorts&quot;: false,</span><br><span class="line">            &quot;ReadonlyRootfs&quot;: false,</span><br><span class="line">            &quot;SecurityOpt&quot;: null,</span><br><span class="line">            &quot;UTSMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;UsernsMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;ShmSize&quot;: 67108864,</span><br><span class="line">            &quot;Runtime&quot;: &quot;runc&quot;,</span><br><span class="line">            &quot;ConsoleSize&quot;: [</span><br><span class="line">                0,</span><br><span class="line">                0</span><br><span class="line">            ],</span><br><span class="line">            &quot;Isolation&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpuShares&quot;: 0,</span><br><span class="line">            &quot;Memory&quot;: 0,</span><br><span class="line">            &quot;NanoCpus&quot;: 0,</span><br><span class="line">            &quot;CgroupParent&quot;: &quot;&quot;,</span><br><span class="line">            &quot;BlkioWeight&quot;: 0,</span><br><span class="line">            &quot;BlkioWeightDevice&quot;: [],</span><br><span class="line">            &quot;BlkioDeviceReadBps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceWriteBps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceReadIOps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceWriteIOps&quot;: null,</span><br><span class="line">            &quot;CpuPeriod&quot;: 0,</span><br><span class="line">            &quot;CpuQuota&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimePeriod&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimeRuntime&quot;: 0,</span><br><span class="line">            &quot;CpusetCpus&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpusetMems&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Devices&quot;: [],</span><br><span class="line">            &quot;DeviceCgroupRules&quot;: null,</span><br><span class="line">            &quot;DeviceRequests&quot;: null,</span><br><span class="line">            &quot;KernelMemory&quot;: 0,</span><br><span class="line">            &quot;KernelMemoryTCP&quot;: 0,</span><br><span class="line">            &quot;MemoryReservation&quot;: 0,</span><br><span class="line">            &quot;MemorySwap&quot;: 0,</span><br><span class="line">            &quot;MemorySwappiness&quot;: null,</span><br><span class="line">            &quot;OomKillDisable&quot;: false,</span><br><span class="line">            &quot;PidsLimit&quot;: null,</span><br><span class="line">            &quot;Ulimits&quot;: null,</span><br><span class="line">            &quot;CpuCount&quot;: 0,</span><br><span class="line">            &quot;CpuPercent&quot;: 0,</span><br><span class="line">            &quot;IOMaximumIOps&quot;: 0,</span><br><span class="line">            &quot;IOMaximumBandwidth&quot;: 0,</span><br><span class="line">            &quot;MaskedPaths&quot;: [</span><br><span class="line">                &quot;/proc/asound&quot;,</span><br><span class="line">                &quot;/proc/acpi&quot;,</span><br><span class="line">                &quot;/proc/kcore&quot;,</span><br><span class="line">                &quot;/proc/keys&quot;,</span><br><span class="line">                &quot;/proc/latency_stats&quot;,</span><br><span class="line">                &quot;/proc/timer_list&quot;,</span><br><span class="line">                &quot;/proc/timer_stats&quot;,</span><br><span class="line">                &quot;/proc/sched_debug&quot;,</span><br><span class="line">                &quot;/proc/scsi&quot;,</span><br><span class="line">                &quot;/sys/firmware&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;ReadonlyPaths&quot;: [</span><br><span class="line">                &quot;/proc/bus&quot;,</span><br><span class="line">                &quot;/proc/fs&quot;,</span><br><span class="line">                &quot;/proc/irq&quot;,</span><br><span class="line">                &quot;/proc/sys&quot;,</span><br><span class="line">                &quot;/proc/sysrq-trigger&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;GraphDriver&quot;: &#123;</span><br><span class="line">            &quot;Data&quot;: &#123;</span><br><span class="line">                &quot;LowerDir&quot;: &quot;/var/lib/docker/overlay2/78d46a1dd3114ea4472382c70d189091005ab80b93b328fdf6917ea374e09135-init/diff:/var/lib/docker/overlay2/9977c7654d8482400f51116d18f3c0562764ac2c1082c8de455e689c10593b30/diff&quot;,</span><br><span class="line">                &quot;MergedDir&quot;: &quot;/var/lib/docker/overlay2/78d46a1dd3114ea4472382c70d189091005ab80b93b328fdf6917ea374e09135/merged&quot;,</span><br><span class="line">                &quot;UpperDir&quot;: &quot;/var/lib/docker/overlay2/78d46a1dd3114ea4472382c70d189091005ab80b93b328fdf6917ea374e09135/diff&quot;,</span><br><span class="line">                &quot;WorkDir&quot;: &quot;/var/lib/docker/overlay2/78d46a1dd3114ea4472382c70d189091005ab80b93b328fdf6917ea374e09135/work&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Name&quot;: &quot;overlay2&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Mounts&quot;: [],</span><br><span class="line">        &quot;Config&quot;: &#123;</span><br><span class="line">            &quot;Hostname&quot;: &quot;ba393184f315&quot;,</span><br><span class="line">            &quot;Domainname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;User&quot;: &quot;&quot;,</span><br><span class="line">            &quot;AttachStdin&quot;: true,</span><br><span class="line">            &quot;AttachStdout&quot;: true,</span><br><span class="line">            &quot;AttachStderr&quot;: true,</span><br><span class="line">            &quot;Tty&quot;: true,</span><br><span class="line">            &quot;OpenStdin&quot;: true,</span><br><span class="line">            &quot;StdinOnce&quot;: true,</span><br><span class="line">            &quot;Env&quot;: [</span><br><span class="line">                &quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Cmd&quot;: [</span><br><span class="line">                &quot;/bin/bash&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Image&quot;: &quot;centos&quot;,</span><br><span class="line">            &quot;Volumes&quot;: null,</span><br><span class="line">            &quot;WorkingDir&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Entrypoint&quot;: null,</span><br><span class="line">            &quot;OnBuild&quot;: null,</span><br><span class="line">            &quot;Labels&quot;: &#123;</span><br><span class="line">                &quot;org.label-schema.build-date&quot;: &quot;20200809&quot;,</span><br><span class="line">                &quot;org.label-schema.license&quot;: &quot;GPLv2&quot;,</span><br><span class="line">                &quot;org.label-schema.name&quot;: &quot;CentOS Base Image&quot;,</span><br><span class="line">                &quot;org.label-schema.schema-version&quot;: &quot;1.0&quot;,</span><br><span class="line">                &quot;org.label-schema.vendor&quot;: &quot;CentOS&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;NetworkSettings&quot;: &#123;</span><br><span class="line">            &quot;Bridge&quot;: &quot;&quot;,</span><br><span class="line">            &quot;SandboxID&quot;: &quot;913e925d94cac8aaa4ead2ed29197af7d07d4fbfd35625642019116a42cff156&quot;,</span><br><span class="line">            &quot;HairpinMode&quot;: false,</span><br><span class="line">            &quot;LinkLocalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LinkLocalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;Ports&quot;: &#123;&#125;,</span><br><span class="line">            &quot;SandboxKey&quot;: &quot;/var/run/docker/netns/913e925d94ca&quot;,</span><br><span class="line">            &quot;SecondaryIPAddresses&quot;: null,</span><br><span class="line">            &quot;SecondaryIPv6Addresses&quot;: null,</span><br><span class="line">            &quot;EndpointID&quot;: &quot;9da28d1e996685ffa1a39d26fe042919d661c4b4c8267f3470f2042ee78810ed&quot;,</span><br><span class="line">            &quot;Gateway&quot;: &quot;172.18.0.1&quot;,</span><br><span class="line">            &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;IPAddress&quot;: &quot;172.18.0.2&quot;,</span><br><span class="line">            &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">            &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">            &quot;MacAddress&quot;: &quot;02:42:ac:12:00:02&quot;,</span><br><span class="line">            &quot;Networks&quot;: &#123;</span><br><span class="line">                &quot;bridge&quot;: &#123;</span><br><span class="line">                    &quot;IPAMConfig&quot;: null,</span><br><span class="line">                    &quot;Links&quot;: null,</span><br><span class="line">                    &quot;Aliases&quot;: null,</span><br><span class="line">                    &quot;NetworkID&quot;: &quot;df77c62f666112b12946dbbbc16f1dcdbbcc8548e3fa56519fd062e5331a0c08&quot;,</span><br><span class="line">                    &quot;EndpointID&quot;: &quot;9da28d1e996685ffa1a39d26fe042919d661c4b4c8267f3470f2042ee78810ed&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;172.18.0.1&quot;,</span><br><span class="line">                    &quot;IPAddress&quot;: &quot;172.18.0.2&quot;,</span><br><span class="line">                    &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">                    &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">                    &quot;MacAddress&quot;: &quot;02:42:ac:12:00:02&quot;,</span><br><span class="line">                    &quot;DriverOpts&quot;: null</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p><strong>进入当前运行的容器</strong></p>
<p>通常容器都是后台运行的，有时我们需要进入容器修改一些配置</p>
<p><strong>docker exec -it 容器id bashShell</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@VM-0-15-centos ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">ba393184f315        centos              "/bin/bash"         11 minutes ago      Up 11 minutes                           wizardly_cerf</span><br><span class="line">[root@VM-0-15-centos ~]# docker exec -it ba393184f315 /bin/bash</span><br><span class="line">[root@ba393184f315 /]# ps -ef</span><br><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">root         1     0  0 01:46 pts/0    00:00:00 /bin/bash</span><br><span class="line">root        14     0  0 01:57 pts/1    00:00:00 /bin/bash</span><br><span class="line">root        27    14  0 01:57 pts/1    00:00:00 ps -ef</span><br></pre></td></tr></table></figure>
<p><strong>docker attach 容器id</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@VM-0-15-centos ~]# docker attach ba393184f315</span><br><span class="line">[root@ba393184f315 /]#</span><br></pre></td></tr></table></figure>
<p>docker exec 进入容器后，开启新的终端，可以在里面操作<br>docker attach 进入容器正在执行的终端</p>
<p><strong>从容器拷贝文件到主机</strong></p>
<p><strong>docker cp 容器id:容器内路径  目的的主机路径</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@VM-0-15-centos home]# docker attach b67b64394534</span><br><span class="line">[root@b67b64394534 /]# cd /home </span><br><span class="line">[root@b67b64394534 home]# ls</span><br><span class="line">[root@b67b64394534 home]# touch rx.java</span><br><span class="line">[root@b67b64394534 home]# read escape sequence</span><br><span class="line">[root@VM-0-15-centos home]# </span><br><span class="line">[root@VM-0-15-centos home]# docker cp b67b64394534:/home/rx.java /home</span><br><span class="line">[root@VM-0-15-centos home]# ls</span><br><span class="line">rx.java  rxk.java</span><br></pre></td></tr></table></figure>
<h2 id="Test1-Docker部属nginx"><a href="#Test1-Docker部属nginx" class="headerlink" title="Test1-Docker部属nginx"></a>Test1-Docker部属nginx</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span>下载Nginx</span><br><span class="line">[root@VM-0-15-centos ~]# docker pull nginx</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/nginx</span><br><span class="line">852e50cd189d: Pull complete </span><br><span class="line">571d7e852307: Pull complete </span><br><span class="line">addb10abd9cb: Pull complete </span><br><span class="line">d20aa7ccdb77: Pull complete </span><br><span class="line">8b03f1e11359: Pull complete </span><br><span class="line">Digest: sha256:6b1daa9462046581ac15be20277a7c75476283f969cb3a61c8725ec38d3b01c3</span><br><span class="line">Status: Downloaded newer image for nginx:latest</span><br><span class="line">docker.io/library/nginx:latest</span><br><span class="line"><span class="meta">#</span>查看目前运行镜像</span><br><span class="line">[root@VM-0-15-centos ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">b67b64394534        centos              "/bin/bash"         10 hours ago        Up 10 hours                             suspicious_sutherland</span><br><span class="line">[root@VM-0-15-centos ~]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">nginx               latest              bc9a0695f571        6 days ago          133MB</span><br><span class="line">centos              latest              0d120b6ccaa8        3 months ago        215MB</span><br><span class="line"><span class="meta">#</span>以后台方式运行镜像，并且将nginx的80端口映射到本地3344端口，同时给此镜像一个名字--name nginx01</span><br><span class="line">[root@VM-0-15-centos ~]# docker run -d --name nginx01 -p 3344:80 nginx</span><br><span class="line">5a3e8a8e16e5e1f46b8bbe6c23662aebd3c13dc5cacfd63fb24d0703c1235819</span><br><span class="line">[root@VM-0-15-centos ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES</span><br><span class="line">5a3e8a8e16e5        nginx               "/docker-entrypoint.…"   2 minutes ago       Up 2 minutes        0.0.0.0:3344-&gt;80/tcp   nginx01</span><br><span class="line">b67b64394534        centos              "/bin/bash"              10 hours ago        Up 10 hours                                suspicious_sutherland</span><br><span class="line"><span class="meta">#</span>请求本地3344端口，显示nginx，成功运行</span><br><span class="line">[root@VM-0-15-centos ~]# curl localhost:3344</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    body &#123;</span><br><span class="line">        width: 35em;</span><br><span class="line">        margin: 0 auto;</span><br><span class="line">        font-family: Tahoma, Verdana, Arial, sans-serif;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;For online documentation and support please refer to</span><br><span class="line">&lt;a href="http://nginx.org/"&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;</span><br><span class="line">Commercial support is available at</span><br><span class="line">&lt;a href="http://nginx.com/"&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>进入容器</span><br><span class="line">[root@VM-0-15-centos ~]# docker exec -it nginx01 /bin/bash</span><br><span class="line">root@5a3e8a8e16e5:/# whereis nginx</span><br><span class="line">nginx: /usr/sbin/nginx /usr/lib/nginx /etc/nginx /usr/share/nginx</span><br><span class="line"><span class="meta">#</span>关闭容器</span><br><span class="line">[root@VM-0-15-centos ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES</span><br><span class="line">5a3e8a8e16e5        nginx               "/docker-entrypoint.…"   33 minutes ago      Up 33 minutes       0.0.0.0:3344-&gt;80/tcp   nginx01</span><br><span class="line">b67b64394534        centos              "/bin/bash"              10 hours ago        Up 10 hours                                suspicious_sutherland</span><br><span class="line">[root@VM-0-15-centos ~]# docker stop nginx01</span><br><span class="line">nginx01</span><br><span class="line">[root@VM-0-15-centos ~]# docker stop centos</span><br><span class="line">Error response from daemon: No such container: centos</span><br><span class="line">[root@VM-0-15-centos ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">b67b64394534        centos              "/bin/bash"         10 hours ago        Up 10 hours                             suspicious_sutherland</span><br><span class="line">[root@VM-0-15-centos ~]# docker stop b67b64394534</span><br><span class="line">b67b64394534</span><br></pre></td></tr></table></figure>
<h2 id="Test2-Docker部属tomcat"><a href="#Test2-Docker部属tomcat" class="headerlink" title="Test2-Docker部属tomcat"></a>Test2-Docker部属tomcat</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span>下载并启动tomcat (加了--rm 意味着用完就会删除)</span><br><span class="line">[root@VM-0-15-centos ~]# docker run -it --rm tomcat:9.0</span><br><span class="line">Unable to find image 'tomcat:9.0' locally</span><br><span class="line">9.0: Pulling from library/tomcat</span><br><span class="line">756975cb9c7e: Pull complete </span><br><span class="line">d77915b4e630: Pull complete </span><br><span class="line">5f37a0a41b6b: Pull complete </span><br><span class="line">96b2c1e36db5: Pull complete </span><br><span class="line">27a2d52b526e: Pull complete </span><br><span class="line">a867dba77389: Pull complete </span><br><span class="line">0939c055fb79: Pull complete </span><br><span class="line">0b0694ce0ae2: Pull complete </span><br><span class="line">81a5f8099e05: Pull complete </span><br><span class="line">c3d7917d545e: Pull complete</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>正常下载</span><br><span class="line">[root@VM-0-15-centos ~]# docker pull tomcat:9.0</span><br><span class="line">9.0: Pulling from library/tomcat</span><br><span class="line">Digest: sha256:a319b10d8729817c7ce0bcc2343a6f97711c7870395019340d96b6aafd6ccbea</span><br><span class="line">Status: Image is up to date for tomcat:9.0</span><br><span class="line">docker.io/library/tomcat:9.0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>将tomcat 8080端口映射到外部3355端口</span><br><span class="line">[root@VM-0-15-centos ~]# docker run -d -p 3355:8080 --name tomcat01 tomcat</span><br><span class="line">af2d7437747112b51f83c556b1790503f41e2632bbbe965e00a8bff3d3268c92</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>进入tomcat</span><br><span class="line">[root@VM-0-15-centos ~]# docker exec -it tomcat01 /bin/bash</span><br><span class="line">root@af2d74377471:/usr/local/tomcat# ls</span><br><span class="line">BUILDING.txt	 LICENSE  README.md	 RUNNING.txt  conf  logs	    temp     webapps.dist</span><br><span class="line">CONTRIBUTING.md  NOTICE   RELEASE-NOTES  bin	      lib   native-jni-lib  webapps  work</span><br></pre></td></tr></table></figure>
<h2 id="Test3-Docker部属ES-kibana"><a href="#Test3-Docker部属ES-kibana" class="headerlink" title="Test3-Docker部属ES+kibana"></a>Test3-Docker部属ES+kibana</h2><p>ES暴露的端口较多，十分耗内存，ES的数据一般挂载在安全目录</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span> --net somenetwork网络配置</span><br><span class="line">docker run -d --name elasticsearch --net somenetwork -p 9200:9200 -p 9300:9300 -e "discovery.type=single-node" elasticsearch:tag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>下载并启动ES</span><br><span class="line">docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e "discovery.type=single-node" elasticsearch:7.6.2</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>启动之后 服务器会较为卡顿</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>查看CPU和内存状态</span><br><span class="line"><span class="meta">#</span>docker stats </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>增加内存限制  -e环境配置修改</span><br><span class="line">docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e "discovery.type=single-node" -e ES_JAVA_OPTS="-Xms64m -Xmx512m"  elasticsearch:7.6.2</span><br><span class="line"></span><br><span class="line">CONTAINER ID        NAME                CPU %               MEM USAGE / LIMIT     MEM %               NET I/O             BLOCK I/O           PIDS</span><br><span class="line">db5428acc88d        elasticsearch02     0.77%               358.6MiB / 1.795GiB   19.51%              656B / 0B           6.41MB / 729kB      43</span><br><span class="line">^C</span><br><span class="line">[root@VM-0-15-centos ~]# curl localhost:9200</span><br><span class="line">&#123;</span><br><span class="line">  "name" : "db5428acc88d",</span><br><span class="line">  "cluster_name" : "docker-cluster",</span><br><span class="line">  "cluster_uuid" : "MqrmYUWDTT2jYZJHxsVU0A",</span><br><span class="line">  "version" : &#123;</span><br><span class="line">    "number" : "7.6.2",</span><br><span class="line">    "build_flavor" : "default",</span><br><span class="line">    "build_type" : "docker",</span><br><span class="line">    "build_hash" : "ef48eb35cf30adf4db14086e8aabd07ef6fb113f",</span><br><span class="line">    "build_date" : "2020-03-26T06:34:37.794943Z",</span><br><span class="line">    "build_snapshot" : false,</span><br><span class="line">    "lucene_version" : "8.4.0",</span><br><span class="line">    "minimum_wire_compatibility_version" : "6.8.0",</span><br><span class="line">    "minimum_index_compatibility_version" : "6.0.0-beta1"</span><br><span class="line">  &#125;,</span><br><span class="line">  "tagline" : "You Know, for Search"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="可视化"><a href="#可视化" class="headerlink" title="可视化"></a>可视化</h2><p>启动portainer</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@VM-0-15-centos ~]# docker run -d -p 8088:9000 --restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=true portainer/portainer</span><br><span class="line">Unable to find image 'portainer/portainer:latest' locally</span><br><span class="line">latest: Pulling from portainer/portainer</span><br><span class="line">d1e017099d17: Pull complete </span><br><span class="line">717377b83d5c: Pull complete </span><br><span class="line">Digest: sha256:f8c2b0a9ca640edf508a8a0830cf1963a1e0d2fd9936a64104b3f658e120b868</span><br><span class="line">Status: Downloaded newer image for portainer/portainer:latest</span><br><span class="line">cb19cef5927877f6e10e15013b81fffdaefd5cb2e426f34819fc869c109ab7b3</span><br></pre></td></tr></table></figure>
<h2 id="commit镜像"><a href="#commit镜像" class="headerlink" title="commit镜像"></a>commit镜像</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span>先启动tomcat 并确保在运行</span><br><span class="line">[root@VM-0-15-centos ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                    NAMES</span><br><span class="line">675a7261e3b7        tomcat              "catalina.sh run"   55 seconds ago      Up 54 seconds       0.0.0.0:8080-&gt;8080/tcp   heuristic_curie</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>进入tomcat</span><br><span class="line">[root@VM-0-15-centos ~]# docker exec -it 675a7261e3b7 /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>将webapps中的东西复制上去</span><br><span class="line">root@675a7261e3b7:/usr/local/tomcat# cd webapps</span><br><span class="line">root@675a7261e3b7:/usr/local/tomcat/webapps# ls</span><br><span class="line">root@675a7261e3b7:/usr/local/tomcat/webapps# cd ..</span><br><span class="line">root@675a7261e3b7:/usr/local/tomcat# cp -r webapps.dist/* webapps</span><br><span class="line">root@675a7261e3b7:/usr/local/tomcat# cd webapps</span><br><span class="line">root@675a7261e3b7:/usr/local/tomcat/webapps# ls</span><br><span class="line">ROOT  docs  examples  host-manager  manager</span><br><span class="line">root@675a7261e3b7:/usr/local/tomcat/webapps# exit</span><br><span class="line">[root@VM-0-15-centos ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                    NAMES</span><br><span class="line">675a7261e3b7        tomcat              "catalina.sh run"   7 minutes ago       Up 7 minutes        0.0.0.0:8080-&gt;8080/tcp   heuristic_curie</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>commit一个镜像,-a是作者,-m是描述</span><br><span class="line">[root@VM-0-15-centos ~]# docker commit -a="cinkate" -m="add webapps" 675a7261e3b7 tomcat02:1.0</span><br><span class="line">sha256:80b6126c75b93053ee013c1a724a10fb958ddab21e5b0f3f10a58dbb996c74eb</span><br><span class="line">[root@VM-0-15-centos ~]# docker imgaes</span><br><span class="line">docker: 'imgaes' is not a docker command.</span><br><span class="line">See 'docker --help'</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>查看是否commit成功</span><br><span class="line">[root@VM-0-15-centos ~]# docker images</span><br><span class="line">REPOSITORY            TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">tomcat02              1.0                 80b6126c75b9        8 seconds ago       654MB</span><br><span class="line">nginx                 latest              bc9a0695f571        8 days ago          133MB</span><br><span class="line">tomcat                9.0                 e0bd8b34b4ea        2 weeks ago         649MB</span><br><span class="line">tomcat                latest              e0bd8b34b4ea        2 weeks ago         649MB</span><br><span class="line">centos                latest              0d120b6ccaa8        3 months ago        215MB</span><br><span class="line">portainer/portainer   latest              62771b0b9b09        4 months ago        79.1MB</span><br><span class="line">elasticsearch         7.6.2               f29a1ee41030        8 months ago        791MB</span><br></pre></td></tr></table></figure>
<h2 id="docker容器数据卷"><a href="#docker容器数据卷" class="headerlink" title="docker容器数据卷"></a>docker容器数据卷</h2><p>即使删除了容器，数据还是存在的，类似于数据持久化<br>容器之间应该有一个数据共享的技术！Docker容器中产生的数据，同步到本地！</p>
<p>这就是卷技术！目录的挂载，将容器的目录，挂载到Linux上面！</p>
<p>总结：为了容器的持久化和同步操作~，容器间也是可以数据共享！</p>
<h3 id="使用数据卷"><a href="#使用数据卷" class="headerlink" title="使用数据卷"></a>使用数据卷</h3><blockquote>
<p>方式一：直接使用命令来挂载</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span>-v 主机目录，容器内目录</span><br><span class="line"><span class="meta">#</span>-p 主机端口，容器内端口</span><br><span class="line">[root@VM-0-15-centos ~]# docker run -it -v</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>将centos /home下的目录 挂载到 主机下/home/ceshi下</span><br><span class="line">[root@VM-0-15-centos home]# docker run -it -v /home/ceshi:/home centos /bin/bash</span><br><span class="line">[root@081342dcbd4f /]# </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>另一个terminal(本机的home目录)</span><br><span class="line">[root@VM-0-15-centos ~]# cd /home</span><br><span class="line">[root@VM-0-15-centos home]# ls</span><br><span class="line">ceshi  rx.java  rxk.java</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>查看元信息，挂载成功 Mounts</span><br><span class="line">[root@VM-0-15-centos home]# docker inspect 081342dcbd4f</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        "Id": "081342dcbd4f81f7d9d8495b8741dc2270b88d89123f5f422802cece726e75ee",</span><br><span class="line">        "Created": "2020-12-03T13:39:28.974545204Z",</span><br><span class="line">        "Path": "/bin/bash",</span><br><span class="line">        "Args": [],</span><br><span class="line">        "State": &#123;</span><br><span class="line">            "Status": "running",</span><br><span class="line">            "Running": true,</span><br><span class="line">            "Paused": false,</span><br><span class="line">            "Restarting": false,</span><br><span class="line">            "OOMKilled": false,</span><br><span class="line">            "Dead": false,</span><br><span class="line">            "Pid": 1314,</span><br><span class="line">            "ExitCode": 0,</span><br><span class="line">            "Error": "",</span><br><span class="line">            "StartedAt": "2020-12-03T13:39:29.238082253Z",</span><br><span class="line">            "FinishedAt": "0001-01-01T00:00:00Z"</span><br><span class="line">        &#125;,</span><br><span class="line">        "Image": "sha256:0d120b6ccaa8c5e149176798b3501d4dd1885f961922497cd0abef155c869566",</span><br><span class="line">        "ResolvConfPath": "/var/lib/docker/containers/081342dcbd4f81f7d9d8495b8741dc2270b88d89123f5f422802cece726e75ee/resolv.conf",</span><br><span class="line">        "HostnamePath": "/var/lib/docker/containers/081342dcbd4f81f7d9d8495b8741dc2270b88d89123f5f422802cece726e75ee/hostname",</span><br><span class="line">        "HostsPath": "/var/lib/docker/containers/081342dcbd4f81f7d9d8495b8741dc2270b88d89123f5f422802cece726e75ee/hosts",</span><br><span class="line">        "LogPath": "/var/lib/docker/containers/081342dcbd4f81f7d9d8495b8741dc2270b88d89123f5f422802cece726e75ee/081342dcbd4f81f7d9d8495b8741dc2270b88d89123f5f422802cece726e75ee-json.log",</span><br><span class="line">        "Name": "/clever_lovelace",</span><br><span class="line">        "RestartCount": 0,</span><br><span class="line">        "Driver": "overlay2",</span><br><span class="line">        "Platform": "linux",</span><br><span class="line">        "MountLabel": "",</span><br><span class="line">        "ProcessLabel": "",</span><br><span class="line">        "AppArmorProfile": "",</span><br><span class="line">        "ExecIDs": null,</span><br><span class="line">        "HostConfig": &#123;</span><br><span class="line">            "Binds": [</span><br><span class="line">                "/home/ceshi:/home"</span><br><span class="line">            ],</span><br><span class="line">            "ContainerIDFile": "",</span><br><span class="line">            "LogConfig": &#123;</span><br><span class="line">                "Type": "json-file",</span><br><span class="line">                "Config": &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            "NetworkMode": "default",</span><br><span class="line">            "PortBindings": &#123;&#125;,</span><br><span class="line">            "RestartPolicy": &#123;</span><br><span class="line">                "Name": "no",</span><br><span class="line">                "MaximumRetryCount": 0</span><br><span class="line">            &#125;,</span><br><span class="line">            "AutoRemove": false,</span><br><span class="line">            "VolumeDriver": "",</span><br><span class="line">            "VolumesFrom": null,</span><br><span class="line">            "CapAdd": null,</span><br><span class="line">            "CapDrop": null,</span><br><span class="line">            "Capabilities": null,</span><br><span class="line">            "Dns": [],</span><br><span class="line">            "DnsOptions": [],</span><br><span class="line">            "DnsSearch": [],</span><br><span class="line">            "ExtraHosts": null,</span><br><span class="line">            "GroupAdd": null,</span><br><span class="line">            "IpcMode": "private",</span><br><span class="line">            "Cgroup": "",</span><br><span class="line">            "Links": null,</span><br><span class="line">            "OomScoreAdj": 0,</span><br><span class="line">            "PidMode": "",</span><br><span class="line">            "Privileged": false,</span><br><span class="line">            "PublishAllPorts": false,</span><br><span class="line">            "ReadonlyRootfs": false,</span><br><span class="line">            "SecurityOpt": null,</span><br><span class="line">            "UTSMode": "",</span><br><span class="line">            "UsernsMode": "",</span><br><span class="line">            "ShmSize": 67108864,</span><br><span class="line">            "Runtime": "runc",</span><br><span class="line">            "ConsoleSize": [</span><br><span class="line">                0,</span><br><span class="line">                0</span><br><span class="line">            ],</span><br><span class="line">            "Isolation": "",</span><br><span class="line">            "CpuShares": 0,</span><br><span class="line">            "Memory": 0,</span><br><span class="line">            "NanoCpus": 0,</span><br><span class="line">            "CgroupParent": "",</span><br><span class="line">            "BlkioWeight": 0,</span><br><span class="line">            "BlkioWeightDevice": [],</span><br><span class="line">            "BlkioDeviceReadBps": null,</span><br><span class="line">            "BlkioDeviceWriteBps": null,</span><br><span class="line">            "BlkioDeviceReadIOps": null,</span><br><span class="line">            "BlkioDeviceWriteIOps": null,</span><br><span class="line">            "CpuPeriod": 0,</span><br><span class="line">            "CpuQuota": 0,</span><br><span class="line">            "CpuRealtimePeriod": 0,</span><br><span class="line">            "CpuRealtimeRuntime": 0,</span><br><span class="line">            "CpusetCpus": "",</span><br><span class="line">            "CpusetMems": "",</span><br><span class="line">            "Devices": [],</span><br><span class="line">            "DeviceCgroupRules": null,</span><br><span class="line">            "DeviceRequests": null,</span><br><span class="line">            "KernelMemory": 0,</span><br><span class="line">            "KernelMemoryTCP": 0,</span><br><span class="line">            "MemoryReservation": 0,</span><br><span class="line">            "MemorySwap": 0,</span><br><span class="line">            "MemorySwappiness": null,</span><br><span class="line">            "OomKillDisable": false,</span><br><span class="line">            "PidsLimit": null,</span><br><span class="line">            "Ulimits": null,</span><br><span class="line">            "CpuCount": 0,</span><br><span class="line">            "CpuPercent": 0,</span><br><span class="line">            "IOMaximumIOps": 0,</span><br><span class="line">            "IOMaximumBandwidth": 0,</span><br><span class="line">            "MaskedPaths": [</span><br><span class="line">                "/proc/asound",</span><br><span class="line">                "/proc/acpi",</span><br><span class="line">                "/proc/kcore",</span><br><span class="line">                "/proc/keys",</span><br><span class="line">                "/proc/latency_stats",</span><br><span class="line">                "/proc/timer_list",</span><br><span class="line">                "/proc/timer_stats",</span><br><span class="line">                "/proc/sched_debug",</span><br><span class="line">                "/proc/scsi",</span><br><span class="line">                "/sys/firmware"</span><br><span class="line">            ],</span><br><span class="line">            "ReadonlyPaths": [</span><br><span class="line">                "/proc/bus",</span><br><span class="line">                "/proc/fs",</span><br><span class="line">                "/proc/irq",</span><br><span class="line">                "/proc/sys",</span><br><span class="line">                "/proc/sysrq-trigger"</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        "GraphDriver": &#123;</span><br><span class="line">            "Data": &#123;</span><br><span class="line">                "LowerDir": "/var/lib/docker/overlay2/519ce3c698154cf997249d71ab41e9203f413522d25e777dc5f8544f2ba22c9e-init/diff:/var/lib/docker/overlay2/9977c7654d8482400f51116d18f3c0562764ac2c1082c8de455e689c10593b30/diff",</span><br><span class="line">                "MergedDir": "/var/lib/docker/overlay2/519ce3c698154cf997249d71ab41e9203f413522d25e777dc5f8544f2ba22c9e/merged",</span><br><span class="line">                "UpperDir": "/var/lib/docker/overlay2/519ce3c698154cf997249d71ab41e9203f413522d25e777dc5f8544f2ba22c9e/diff",</span><br><span class="line">                "WorkDir": "/var/lib/docker/overlay2/519ce3c698154cf997249d71ab41e9203f413522d25e777dc5f8544f2ba22c9e/work"</span><br><span class="line">            &#125;,</span><br><span class="line">            "Name": "overlay2"</span><br><span class="line">        &#125;,</span><br><span class="line">        "Mounts": [</span><br><span class="line">            &#123;</span><br><span class="line">                "Type": "bind",</span><br><span class="line">                "Source": "/home/ceshi",</span><br><span class="line">                "Destination": "/home",</span><br><span class="line">                "Mode": "",</span><br><span class="line">                "RW": true,</span><br><span class="line">                "Propagation": "rprivate"</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        "Config": &#123;</span><br><span class="line">            "Hostname": "081342dcbd4f",</span><br><span class="line">            "Domainname": "",</span><br><span class="line">            "User": "",</span><br><span class="line">            "AttachStdin": true,</span><br><span class="line">            "AttachStdout": true,</span><br><span class="line">            "AttachStderr": true,</span><br><span class="line">            "Tty": true,</span><br><span class="line">            "OpenStdin": true,</span><br><span class="line">            "StdinOnce": true,</span><br><span class="line">            "Env": [</span><br><span class="line">                "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span><br><span class="line">            ],</span><br><span class="line">            "Cmd": [</span><br><span class="line">                "/bin/bash"</span><br><span class="line">            ],</span><br><span class="line">            "Image": "centos",</span><br><span class="line">            "Volumes": null,</span><br><span class="line">            "WorkingDir": "",</span><br><span class="line">            "Entrypoint": null,</span><br><span class="line">            "OnBuild": null,</span><br><span class="line">            "Labels": &#123;</span><br><span class="line">                "org.label-schema.build-date": "20200809",</span><br><span class="line">                "org.label-schema.license": "GPLv2",</span><br><span class="line">                "org.label-schema.name": "CentOS Base Image",</span><br><span class="line">                "org.label-schema.schema-version": "1.0",</span><br><span class="line">                "org.label-schema.vendor": "CentOS"</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        "NetworkSettings": &#123;</span><br><span class="line">            "Bridge": "",</span><br><span class="line">            "SandboxID": "7cc48bb3849fdd8ca238a8ba1f09409e01e7c50856abbccf23d59caaf5997c8d",</span><br><span class="line">            "HairpinMode": false,</span><br><span class="line">            "LinkLocalIPv6Address": "",</span><br><span class="line">            "LinkLocalIPv6PrefixLen": 0,</span><br><span class="line">            "Ports": &#123;&#125;,</span><br><span class="line">            "SandboxKey": "/var/run/docker/netns/7cc48bb3849f",</span><br><span class="line">            "SecondaryIPAddresses": null,</span><br><span class="line">            "SecondaryIPv6Addresses": null,</span><br><span class="line">            "EndpointID": "6bcd4d80b78f3f8ddeb0ee5468ba2e738509eafd745ca2a5e969ff0fa6dceb08",</span><br><span class="line">            "Gateway": "172.18.0.1",</span><br><span class="line">            "GlobalIPv6Address": "",</span><br><span class="line">            "GlobalIPv6PrefixLen": 0,</span><br><span class="line">            "IPAddress": "172.18.0.2",</span><br><span class="line">            "IPPrefixLen": 16,</span><br><span class="line">            "IPv6Gateway": "",</span><br><span class="line">            "MacAddress": "02:42:ac:12:00:02",</span><br><span class="line">            "Networks": &#123;</span><br><span class="line">                "bridge": &#123;</span><br><span class="line">                    "IPAMConfig": null,</span><br><span class="line">                    "Links": null,</span><br><span class="line">                    "Aliases": null,</span><br><span class="line">                    "NetworkID": "df77c62f666112b12946dbbbc16f1dcdbbcc8548e3fa56519fd062e5331a0c08",</span><br><span class="line">                    "EndpointID": "6bcd4d80b78f3f8ddeb0ee5468ba2e738509eafd745ca2a5e969ff0fa6dceb08",</span><br><span class="line">                    "Gateway": "172.18.0.1",</span><br><span class="line">                    "IPAddress": "172.18.0.2",</span><br><span class="line">                    "IPPrefixLen": 16,</span><br><span class="line">                    "IPv6Gateway": "",</span><br><span class="line">                    "GlobalIPv6Address": "",</span><br><span class="line">                    "GlobalIPv6PrefixLen": 0,</span><br><span class="line">                    "MacAddress": "02:42:ac:12:00:02",</span><br><span class="line">                    "DriverOpts": null</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>容器的home目录下</span><br><span class="line">[root@081342dcbd4f home]# touch test.java</span><br><span class="line">[root@081342dcbd4f home]# ls</span><br><span class="line">test.java</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>主机挂载的ceshi目录下</span><br><span class="line">[root@VM-0-15-centos home]# cd ceshi/</span><br><span class="line">[root@VM-0-15-centos ceshi]# ls</span><br><span class="line">test.java</span><br></pre></td></tr></table></figure>
<p>关闭容器之后，在主机中挂载的目录中创建，修改文件，都是可以同步到容器中的目录。</p>
<h2 id="Test4–安装MySQL"><a href="#Test4–安装MySQL" class="headerlink" title="Test4–安装MySQL"></a>Test4–安装MySQL</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span>获取镜像</span><br><span class="line">[root@VM-0-15-centos home]# docker pull mysql:5.7</span><br><span class="line">5.7: Pulling from library/mysql</span><br><span class="line">852e50cd189d: Already exists </span><br><span class="line">29969ddb0ffb: Pull complete </span><br><span class="line">a43f41a44c48: Pull complete </span><br><span class="line">5cdd802543a3: Pull complete </span><br><span class="line">b79b040de953: Pull complete </span><br><span class="line">938c64119969: Pull complete </span><br><span class="line">7689ec51a0d9: Pull complete </span><br><span class="line">36bd6224d58f: Pull complete </span><br><span class="line">cab9d3fa4c8c: Pull complete </span><br><span class="line">1b741e1c47de: Pull complete </span><br><span class="line">aac9d11987ac: Pull complete </span><br><span class="line">Digest: sha256:8e2004f9fe43df06c3030090f593021a5f283d028b5ed5765cc24236c2c4d88e</span><br><span class="line">Status: Downloaded newer image for mysql:5.7</span><br><span class="line">docker.io/library/mysql:5.7</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>运行容器，需要做数据挂载</span><br><span class="line"><span class="meta">#</span> -d后台启动</span><br><span class="line"><span class="meta">#</span> -p端口映射</span><br><span class="line"><span class="meta">#</span> -v 挂载配置文件 和 数据文件</span><br><span class="line"><span class="meta">#</span> -e 修改环境变量，修改密码</span><br><span class="line"><span class="meta">#</span> --name 重命名</span><br><span class="line">[root@VM-0-15-centos home]# docker run -d -p 3310:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7</span><br><span class="line">2f81782daf7d49e73365da7def107120a8f79c71b9c5bb21a4fc082f2ebef664</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>启动成功后，使用本地数据库管理软件可以进行正常连接</span><br></pre></td></tr></table></figure>
<p>假设将容器删除，挂载在本地的数据卷不会丢失，实现了容器的持久化技术。</p>
<h2 id="具名和匿名挂载"><a href="#具名和匿名挂载" class="headerlink" title="具名和匿名挂载"></a>具名和匿名挂载</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span>匿名挂载</span><br><span class="line"></span><br><span class="line">-v不写本地路径，会匿名进行挂载</span><br><span class="line">docker run -d -P --name nginx01 -v /etc/nginx nginx</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>具名挂载</span><br><span class="line">docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx nginx</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>通过-v  卷名:容器内路径</span><br><span class="line"><span class="meta">#</span>查看这个卷</span><br><span class="line">所有docker容器内的卷，没有指定目录的情况下：</span><br><span class="line">都是在</span><br><span class="line">/var/lib/docker/volumes/xxxx/_data</span><br><span class="line"></span><br><span class="line">通过具名挂载，可以方便的找到一个卷，大多数情况使用具名挂载</span><br></pre></td></tr></table></figure>
<p>如何确定是具名还是匿名挂载？还是指定路径挂载？</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">-v 容器内路径 #匿名挂载</span><br><span class="line">-v 卷名:容器内路径 #具名挂载</span><br><span class="line">-v /宿主机路径:容器内路径  #指定路径挂载</span><br></pre></td></tr></table></figure>
<p>拓展</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span>通过 -v 容器内路径:ro rw 可以改变读写权限</span><br><span class="line"><span class="meta">#</span>ro readonly</span><br><span class="line"><span class="meta">#</span>rw readwrite</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>一旦设定了容器权限，容器对我们挂载出来的内容就有限定了！</span><br><span class="line"><span class="meta">#</span>ro  说明这个路径只能通过宿主机来操作，容器内部无法操作！</span><br><span class="line">docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx:ro nginx</span><br><span class="line"></span><br><span class="line">docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx:rw nginx</span><br></pre></td></tr></table></figure>
<h2 id="初始Dockerfile"><a href="#初始Dockerfile" class="headerlink" title="初始Dockerfile"></a>初始Dockerfile</h2><blockquote>
<p>方式二：Dockerfile就是用来构建docker镜像的构建文件！通过这个脚本，可以生成镜像，脚本为一个个命令，每个命令都是一层。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span>构建一个rxk/centos</span><br><span class="line"></span><br><span class="line">[root@VM-0-15-centos home]# cd docker-test-volume/</span><br><span class="line">[root@VM-0-15-centos docker-test-volume]# ls</span><br><span class="line">[root@VM-0-15-centos docker-test-volume]# pwd</span><br><span class="line">/home/docker-test-volume</span><br><span class="line">[root@VM-0-15-centos docker-test-volume]# </span><br><span class="line">[root@VM-0-15-centos docker-test-volume]# nano dockerfile1</span><br><span class="line"><span class="meta">#</span>文件中的内容</span><br><span class="line">[root@VM-0-15-centos docker-test-volume]# cat dockerfile1 </span><br><span class="line">FROM centos</span><br><span class="line">VOLUME ["volume01","volume02"]</span><br><span class="line">CMD echo "-----end-------"</span><br><span class="line">CMD /bin/bash</span><br><span class="line">[root@VM-0-15-centos docker-test-volume]# docker build -f dockerfile1 -t /rxk/centos .</span><br><span class="line">invalid argument "/rxk/centos" for "-t, --tag" flag: invalid reference format</span><br><span class="line">See 'docker build --help'.</span><br><span class="line">[root@VM-0-15-centos docker-test-volume]# docker build -f dockerfile1 -t rxk/centos .</span><br><span class="line">Sending build context to Docker daemon  2.048kB</span><br><span class="line">Step 1/4 : FROM centos</span><br><span class="line"><span class="meta"> ---&gt;</span> 0d120b6ccaa8</span><br><span class="line">Step 2/4 : VOLUME ["volume01","volume02"]</span><br><span class="line"><span class="meta"> ---&gt;</span> Running in 634e59a80996</span><br><span class="line">Removing intermediate container 634e59a80996</span><br><span class="line"><span class="meta"> ---&gt;</span> 02a6fde9ba35</span><br><span class="line">Step 3/4 : CMD echo "-----end-------"</span><br><span class="line"><span class="meta"> ---&gt;</span> Running in 3fe4feb278df</span><br><span class="line">Removing intermediate container 3fe4feb278df</span><br><span class="line"><span class="meta"> ---&gt;</span> d64085501c38</span><br><span class="line">Step 4/4 : CMD /bin/bash</span><br><span class="line"><span class="meta"> ---&gt;</span> Running in 09d704b706fe</span><br><span class="line">Removing intermediate container 09d704b706fe</span><br><span class="line"><span class="meta"> ---&gt;</span> 7735159af50c</span><br><span class="line">Successfully built 7735159af50c</span><br><span class="line">Successfully tagged rxk/centos:latest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>查看当前镜像</span><br><span class="line">[root@VM-0-15-centos docker-test-volume]# docker images</span><br><span class="line">REPOSITORY            TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">rxk/centos            latest              7735159af50c        5 minutes ago       215MB</span><br><span class="line">tomcat02              1.0                 80b6126c75b9        7 hours ago         654MB</span><br><span class="line">nginx                 latest              bc9a0695f571        8 days ago          133MB</span><br><span class="line">mysql                 5.7                 ae0658fdbad5        12 days ago         449MB</span><br><span class="line">tomcat                9.0                 e0bd8b34b4ea        2 weeks ago         649MB</span><br><span class="line">tomcat                latest              e0bd8b34b4ea        2 weeks ago         649MB</span><br><span class="line">centos                latest              0d120b6ccaa8        3 months ago        215MB</span><br><span class="line">portainer/portainer   latest              62771b0b9b09        4 months ago        79.1MB</span><br><span class="line">elasticsearch         7.6.2               f29a1ee41030        8 months ago        791MB</span><br><span class="line"><span class="meta">#</span>进入自己</span><br><span class="line">[root@VM-0-15-centos docker-test-volume]# docker run -it 7735159af50c /bin/bash</span><br><span class="line"><span class="meta">#</span>可以看到挂载的两个volume卷</span><br><span class="line">[root@d6463f570ce4 /]# ls -l</span><br><span class="line">total 56</span><br><span class="line">lrwxrwxrwx  1 root root    7 May 11  2019 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x  5 root root  360 Dec  3 15:21 dev</span><br><span class="line">drwxr-xr-x  1 root root 4096 Dec  3 15:21 etc</span><br><span class="line">drwxr-xr-x  2 root root 4096 May 11  2019 home</span><br><span class="line">lrwxrwxrwx  1 root root    7 May 11  2019 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx  1 root root    9 May 11  2019 lib64 -&gt; usr/lib64</span><br><span class="line">drwx------  2 root root 4096 Aug  9 21:40 lost+found</span><br><span class="line">drwxr-xr-x  2 root root 4096 May 11  2019 media</span><br><span class="line">drwxr-xr-x  2 root root 4096 May 11  2019 mnt</span><br><span class="line">drwxr-xr-x  2 root root 4096 May 11  2019 opt</span><br><span class="line">dr-xr-xr-x 91 root root    0 Dec  3 15:21 proc</span><br><span class="line">dr-xr-x---  2 root root 4096 Aug  9 21:40 root</span><br><span class="line">drwxr-xr-x 11 root root 4096 Aug  9 21:40 run</span><br><span class="line">lrwxrwxrwx  1 root root    8 May 11  2019 sbin -&gt; usr/sbin</span><br><span class="line">drwxr-xr-x  2 root root 4096 May 11  2019 srv</span><br><span class="line">dr-xr-xr-x 13 root root    0 Dec  3 15:21 sys</span><br><span class="line">drwxrwxrwt  7 root root 4096 Aug  9 21:40 tmp</span><br><span class="line">drwxr-xr-x 12 root root 4096 Aug  9 21:40 usr</span><br><span class="line">drwxr-xr-x 20 root root 4096 Aug  9 21:40 var</span><br><span class="line">drwxr-xr-x  2 root root 4096 Dec  3 15:21 volume01</span><br><span class="line">drwxr-xr-x  2 root root 4096 Dec  3 15:21 volume02</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>这个卷Volume一定和外部有一个同步的目录</span><br><span class="line">[root@d6463f570ce4 volume01]# touch container.txt</span><br><span class="line">[root@d6463f570ce4 volume01]# ls</span><br><span class="line">container.txt</span><br><span class="line">[root@d6463f570ce4 volume01]# [root@VM-0-15-centos docker-test-volume]# </span><br><span class="line">[root@VM-0-15-centos docker-test-volume]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">d6463f570ce4        7735159af50c        "/bin/bash"         7 minutes ago       Up 7 minutes                            zen_faraday</span><br><span class="line">[root@VM-0-15-centos docker-test-volume]# docker inspect d6463f570ce4</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        "Id": "d6463f570ce423c10082cce5414bf5ba70b8cb9f0ab47df998fde77b8e965881",</span><br><span class="line">        "Created": "2020-12-03T15:21:34.913373526Z",</span><br><span class="line">        "Path": "/bin/bash",</span><br><span class="line">        "Args": [],</span><br><span class="line">        "State": &#123;</span><br><span class="line">            "Status": "running",</span><br><span class="line">            "Running": true,</span><br><span class="line">            "Paused": false,</span><br><span class="line">            "Restarting": false,</span><br><span class="line">            "OOMKilled": false,</span><br><span class="line">            "Dead": false,</span><br><span class="line">            "Pid": 15638,</span><br><span class="line">            "ExitCode": 0,</span><br><span class="line">            "Error": "",</span><br><span class="line">            "StartedAt": "2020-12-03T15:21:35.202804066Z",</span><br><span class="line">            "FinishedAt": "0001-01-01T00:00:00Z"</span><br><span class="line">        &#125;,</span><br><span class="line">        "Image": "sha256:7735159af50c4ff09863f0a97c37447043ac0eca6657913a4e33c65b0be4a24d",</span><br><span class="line">        "ResolvConfPath": "/var/lib/docker/containers/d6463f570ce423c10082cce5414bf5ba70b8cb9f0ab47df998fde77b8e965881/resolv.conf",</span><br><span class="line">        "HostnamePath": "/var/lib/docker/containers/d6463f570ce423c10082cce5414bf5ba70b8cb9f0ab47df998fde77b8e965881/hostname",</span><br><span class="line">        "HostsPath": "/var/lib/docker/containers/d6463f570ce423c10082cce5414bf5ba70b8cb9f0ab47df998fde77b8e965881/hosts",</span><br><span class="line">        "LogPath": "/var/lib/docker/containers/d6463f570ce423c10082cce5414bf5ba70b8cb9f0ab47df998fde77b8e965881/d6463f570ce423c10082cce5414bf5ba70b8cb9f0ab47df998fde77b8e965881-json.log",</span><br><span class="line">        "Name": "/zen_faraday",</span><br><span class="line">        "RestartCount": 0,</span><br><span class="line">        "Driver": "overlay2",</span><br><span class="line">        "Platform": "linux",</span><br><span class="line">        "MountLabel": "",</span><br><span class="line">        "ProcessLabel": "",</span><br><span class="line">        "AppArmorProfile": "",</span><br><span class="line">        "ExecIDs": null,</span><br><span class="line">        "HostConfig": &#123;</span><br><span class="line">            "Binds": null,</span><br><span class="line">            "ContainerIDFile": "",</span><br><span class="line">            "LogConfig": &#123;</span><br><span class="line">                "Type": "json-file",</span><br><span class="line">                "Config": &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            "NetworkMode": "default",</span><br><span class="line">            "PortBindings": &#123;&#125;,</span><br><span class="line">            "RestartPolicy": &#123;</span><br><span class="line">                "Name": "no",</span><br><span class="line">                "MaximumRetryCount": 0</span><br><span class="line">            &#125;,</span><br><span class="line">            "AutoRemove": false,</span><br><span class="line">            "VolumeDriver": "",</span><br><span class="line">            "VolumesFrom": null,</span><br><span class="line">            "CapAdd": null,</span><br><span class="line">            "CapDrop": null,</span><br><span class="line">            "Capabilities": null,</span><br><span class="line">            "Dns": [],</span><br><span class="line">            "DnsOptions": [],</span><br><span class="line">            "DnsSearch": [],</span><br><span class="line">            "ExtraHosts": null,</span><br><span class="line">            "GroupAdd": null,</span><br><span class="line">            "IpcMode": "private",</span><br><span class="line">            "Cgroup": "",</span><br><span class="line">            "Links": null,</span><br><span class="line">            "OomScoreAdj": 0,</span><br><span class="line">            "PidMode": "",</span><br><span class="line">            "Privileged": false,</span><br><span class="line">            "PublishAllPorts": false,</span><br><span class="line">            "ReadonlyRootfs": false,</span><br><span class="line">            "SecurityOpt": null,</span><br><span class="line">            "UTSMode": "",</span><br><span class="line">            "UsernsMode": "",</span><br><span class="line">            "ShmSize": 67108864,</span><br><span class="line">            "Runtime": "runc",</span><br><span class="line">            "ConsoleSize": [</span><br><span class="line">                0,</span><br><span class="line">                0</span><br><span class="line">            ],</span><br><span class="line">            "Isolation": "",</span><br><span class="line">            "CpuShares": 0,</span><br><span class="line">            "Memory": 0,</span><br><span class="line">            "NanoCpus": 0,</span><br><span class="line">            "CgroupParent": "",</span><br><span class="line">            "BlkioWeight": 0,</span><br><span class="line">            "BlkioWeightDevice": [],</span><br><span class="line">            "BlkioDeviceReadBps": null,</span><br><span class="line">            "BlkioDeviceWriteBps": null,</span><br><span class="line">            "BlkioDeviceReadIOps": null,</span><br><span class="line">            "BlkioDeviceWriteIOps": null,</span><br><span class="line">            "CpuPeriod": 0,</span><br><span class="line">            "CpuQuota": 0,</span><br><span class="line">            "CpuRealtimePeriod": 0,</span><br><span class="line">            "CpuRealtimeRuntime": 0,</span><br><span class="line">            "CpusetCpus": "",</span><br><span class="line">            "CpusetMems": "",</span><br><span class="line">            "Devices": [],</span><br><span class="line">            "DeviceCgroupRules": null,</span><br><span class="line">            "DeviceRequests": null,</span><br><span class="line">            "KernelMemory": 0,</span><br><span class="line">            "KernelMemoryTCP": 0,</span><br><span class="line">            "MemoryReservation": 0,</span><br><span class="line">            "MemorySwap": 0,</span><br><span class="line">            "MemorySwappiness": null,</span><br><span class="line">            "OomKillDisable": false,</span><br><span class="line">            "PidsLimit": null,</span><br><span class="line">            "Ulimits": null,</span><br><span class="line">            "CpuCount": 0,</span><br><span class="line">            "CpuPercent": 0,</span><br><span class="line">            "IOMaximumIOps": 0,</span><br><span class="line">            "IOMaximumBandwidth": 0,</span><br><span class="line">            "MaskedPaths": [</span><br><span class="line">                "/proc/asound",</span><br><span class="line">                "/proc/acpi",</span><br><span class="line">                "/proc/kcore",</span><br><span class="line">                "/proc/keys",</span><br><span class="line">                "/proc/latency_stats",</span><br><span class="line">                "/proc/timer_list",</span><br><span class="line">                "/proc/timer_stats",</span><br><span class="line">                "/proc/sched_debug",</span><br><span class="line">                "/proc/scsi",</span><br><span class="line">                "/sys/firmware"</span><br><span class="line">            ],</span><br><span class="line">            "ReadonlyPaths": [</span><br><span class="line">                "/proc/bus",</span><br><span class="line">                "/proc/fs",</span><br><span class="line">                "/proc/irq",</span><br><span class="line">                "/proc/sys",</span><br><span class="line">                "/proc/sysrq-trigger"</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        "GraphDriver": &#123;</span><br><span class="line">            "Data": &#123;</span><br><span class="line">                "LowerDir": "/var/lib/docker/overlay2/16864c6fe5942b10aff31e1156dbb08a055e31975f8725d25a205bd9f76b6f23-init/diff:/var/lib/docker/overlay2/9977c7654d8482400f51116d18f3c0562764ac2c1082c8de455e689c10593b30/diff",</span><br><span class="line">                "MergedDir": "/var/lib/docker/overlay2/16864c6fe5942b10aff31e1156dbb08a055e31975f8725d25a205bd9f76b6f23/merged",</span><br><span class="line">                "UpperDir": "/var/lib/docker/overlay2/16864c6fe5942b10aff31e1156dbb08a055e31975f8725d25a205bd9f76b6f23/diff",</span><br><span class="line">                "WorkDir": "/var/lib/docker/overlay2/16864c6fe5942b10aff31e1156dbb08a055e31975f8725d25a205bd9f76b6f23/work"</span><br><span class="line">            &#125;,</span><br><span class="line">            "Name": "overlay2"</span><br><span class="line">        &#125;,</span><br><span class="line">        "Mounts": [</span><br><span class="line">            &#123;</span><br><span class="line">                "Type": "volume",</span><br><span class="line">                "Name": "4bb7c13d437e16eb97bfcc71aa2faac18594ded837fcefc6d266e8ad36845c6a",</span><br><span class="line">                "Source": "/var/lib/docker/volumes/4bb7c13d437e16eb97bfcc71aa2faac18594ded837fcefc6d266e8ad36845c6a/_data",</span><br><span class="line">                "Destination": "volume01",</span><br><span class="line">                "Driver": "local",</span><br><span class="line">                "Mode": "",</span><br><span class="line">                "RW": true,</span><br><span class="line">                "Propagation": ""</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                "Type": "volume",</span><br><span class="line">                "Name": "0eca9d146b2fd63f434657516305c20241da68936914059527e728865109e3f1",</span><br><span class="line">                "Source": "/var/lib/docker/volumes/0eca9d146b2fd63f434657516305c20241da68936914059527e728865109e3f1/_data",</span><br><span class="line">                "Destination": "volume02",</span><br><span class="line">                "Driver": "local",</span><br><span class="line">                "Mode": "",</span><br><span class="line">                "RW": true,</span><br><span class="line">                "Propagation": ""</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        "Config": &#123;</span><br><span class="line">            "Hostname": "d6463f570ce4",</span><br><span class="line">            "Domainname": "",</span><br><span class="line">            "User": "",</span><br><span class="line">            "AttachStdin": true,</span><br><span class="line">            "AttachStdout": true,</span><br><span class="line">            "AttachStderr": true,</span><br><span class="line">            "Tty": true,</span><br><span class="line">            "OpenStdin": true,</span><br><span class="line">            "StdinOnce": true,</span><br><span class="line">            "Env": [</span><br><span class="line">                "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span><br><span class="line">            ],</span><br><span class="line">            "Cmd": [</span><br><span class="line">                "/bin/bash"</span><br><span class="line">            ],</span><br><span class="line">            "Image": "7735159af50c",</span><br><span class="line">            "Volumes": &#123;</span><br><span class="line">                "volume01": &#123;&#125;,</span><br><span class="line">                "volume02": &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            "WorkingDir": "",</span><br><span class="line">            "Entrypoint": null,</span><br><span class="line">            "OnBuild": null,</span><br><span class="line">            "Labels": &#123;</span><br><span class="line">                "org.label-schema.build-date": "20200809",</span><br><span class="line">                "org.label-schema.license": "GPLv2",</span><br><span class="line">                "org.label-schema.name": "CentOS Base Image",</span><br><span class="line">                "org.label-schema.schema-version": "1.0",</span><br><span class="line">                "org.label-schema.vendor": "CentOS"</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        "NetworkSettings": &#123;</span><br><span class="line">            "Bridge": "",</span><br><span class="line">            "SandboxID": "cf151107d8fa56fd220695eed265b431618350222be583761b13354867477e39",</span><br><span class="line">            "HairpinMode": false,</span><br><span class="line">            "LinkLocalIPv6Address": "",</span><br><span class="line">            "LinkLocalIPv6PrefixLen": 0,</span><br><span class="line">            "Ports": &#123;&#125;,</span><br><span class="line">            "SandboxKey": "/var/run/docker/netns/cf151107d8fa",</span><br><span class="line">            "SecondaryIPAddresses": null,</span><br><span class="line">            "SecondaryIPv6Addresses": null,</span><br><span class="line">            "EndpointID": "1c1bab6bce8a119f4731a2555a39256791d792539b260d2fd230aea73940d75b",</span><br><span class="line">            "Gateway": "172.18.0.1",</span><br><span class="line">            "GlobalIPv6Address": "",</span><br><span class="line">            "GlobalIPv6PrefixLen": 0,</span><br><span class="line">            "IPAddress": "172.18.0.2",</span><br><span class="line">            "IPPrefixLen": 16,</span><br><span class="line">            "IPv6Gateway": "",</span><br><span class="line">            "MacAddress": "02:42:ac:12:00:02",</span><br><span class="line">            "Networks": &#123;</span><br><span class="line">                "bridge": &#123;</span><br><span class="line">                    "IPAMConfig": null,</span><br><span class="line">                    "Links": null,</span><br><span class="line">                    "Aliases": null,</span><br><span class="line">                    "NetworkID": "df77c62f666112b12946dbbbc16f1dcdbbcc8548e3fa56519fd062e5331a0c08",</span><br><span class="line">                    "EndpointID": "1c1bab6bce8a119f4731a2555a39256791d792539b260d2fd230aea73940d75b",</span><br><span class="line">                    "Gateway": "172.18.0.1",</span><br><span class="line">                    "IPAddress": "172.18.0.2",</span><br><span class="line">                    "IPPrefixLen": 16,</span><br><span class="line">                    "IPv6Gateway": "",</span><br><span class="line">                    "GlobalIPv6Address": "",</span><br><span class="line">                    "GlobalIPv6PrefixLen": 0,</span><br><span class="line">                    "MacAddress": "02:42:ac:12:00:02",</span><br><span class="line">                    "DriverOpts": null</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="数据卷容器"><a href="#数据卷容器" class="headerlink" title="数据卷容器"></a>数据卷容器</h2><p>不同容器之间同步数据</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span>docker01已经启动了</span><br><span class="line">[root@VM-0-15-centos _data]# docker run -it --name docker02 --volumes-from docker01 rxk/centos</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>--volumes-from类似于 docker02继承docker01</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>即使docker01被删了，docker02中卷的文件也是存在的，类似硬链接</span><br></pre></td></tr></table></figure>
<h2 id="DockerFile"><a href="#DockerFile" class="headerlink" title="DockerFile"></a>DockerFile</h2><p>dockerfile是用来构建docker镜像的文件！命令参数脚本！</p>
<p>构建步骤：</p>
<p>1.编写一个dockerfile文件</p>
<p>2.docker build构建成为一个镜像</p>
<p>3.docker run运行镜像</p>
<p>4.docker push发布镜像(DockerHub、阿里云镜像仓库！)</p>
<p>很多官方镜像都是基础包，很多功能没有，通常会自己搭建自己的镜像。</p>
<h2 id="DockerFile的构建过程"><a href="#DockerFile的构建过程" class="headerlink" title="DockerFile的构建过程"></a>DockerFile的构建过程</h2><p><strong>基础知识</strong></p>
<p>1.每个保留关键字(指令)都必须是大写字母</p>
<p>2.执行从上到下顺序执行</p>
<p>3.# 表示注释</p>
<p>4.每一个指令都会创建提交一个新的镜像层 并提交</p>
<p>DockerFile:构建文件，定义了一切的步骤，源代码。</p>
<p>DockerImages:通过DockerFile构建生成的镜像，最终发布和运行的产品</p>
<p>Docker容器：容器就是镜像运行起来提供服务的</p>
<h2 id="DockerFile的指令"><a href="#DockerFile的指令" class="headerlink" title="DockerFile的指令"></a>DockerFile的指令</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">FROM  # 基础镜像，一切从这里开始构建</span><br><span class="line"></span><br><span class="line">MAINTAINER  #镜像是谁写的，姓名+邮箱</span><br><span class="line"></span><br><span class="line">RUN #镜像构建的时候需要运行的命令</span><br><span class="line"></span><br><span class="line">ADD #步骤：构建基于tomcat的镜像，进行添加！ADD为添加内容</span><br><span class="line"></span><br><span class="line">WORKDIR #镜像的工作目录</span><br><span class="line"></span><br><span class="line">VOLUME #挂载的容器卷</span><br><span class="line"></span><br><span class="line">EXPOSE #指定暴露端口</span><br><span class="line"></span><br><span class="line">CMD #指定这个容器启动时候要运行的命令，只有最后一个会生效，可被替代</span><br><span class="line"></span><br><span class="line">ENTRYPOINT #指定这个容器启动的时候要运行的命令，可以追加命令</span><br><span class="line"></span><br><span class="line">ONBUILD #当构建一个被继承DockerFile， 这个时候就会运行ONBUILD命令。触发指令</span><br><span class="line"></span><br><span class="line">COPY #类似ADD命令 ，将文件拷贝到镜像中</span><br><span class="line"></span><br><span class="line">ENV #构建时候设置环境变量</span><br></pre></td></tr></table></figure>
<h2 id="构建自己的centos"><a href="#构建自己的centos" class="headerlink" title="构建自己的centos"></a>构建自己的centos</h2><blockquote>
<p>构建自己的centos</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span>1.编写dockerfile的文件</span><br><span class="line">FROM centos</span><br><span class="line">MAINTAINER kuangshen&lt;179049243@qq.com&gt;</span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line">RUN yum -y install net-tools</span><br><span class="line"></span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line">CMD echo $MYPATH</span><br><span class="line">CMD echo "----end----"</span><br><span class="line">CMD /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>2.通过文件构建镜像</span><br><span class="line"><span class="meta">#</span> docker build -f dockerfile文件路径 -t 镜像名:[tag].</span><br><span class="line"><span class="meta">#</span>docker build -f my-dockerfile -t mycentos:0.1 .</span><br><span class="line">[root@VM-0-15-centos dockerfile]# docker build -f my-dockerfile -t mycentos:0.1 .</span><br><span class="line">Sending build context to Docker daemon  2.048kB</span><br><span class="line">Step 1/10 : FROM centos</span><br><span class="line"><span class="meta"> ---&gt;</span> 0d120b6ccaa8</span><br><span class="line">Step 2/10 : MAINTAINER kuangshen&lt;179049243@qq.com&gt;</span><br><span class="line"><span class="meta"> ---&gt;</span> Running in 3dd9d64bfbff</span><br><span class="line">Removing intermediate container 3dd9d64bfbff</span><br><span class="line"><span class="meta"> ---&gt;</span> e56a7b5f722b</span><br><span class="line">Step 3/10 : ENV MYPATH /usr/local</span><br><span class="line"><span class="meta"> ---&gt;</span> Running in 7707c6ee0441</span><br><span class="line">Removing intermediate container 7707c6ee0441</span><br><span class="line"><span class="meta"> ---&gt;</span> b67dab755631</span><br><span class="line">Step 4/10 : WORKDIR $MYPATH</span><br><span class="line"><span class="meta"> ---&gt;</span> Running in 1797c746ab6b</span><br><span class="line">Removing intermediate container 1797c746ab6b</span><br><span class="line"><span class="meta"> ---&gt;</span> 3ed5689097b4</span><br><span class="line">Step 5/10 : RUN yum -y install vim</span><br><span class="line"><span class="meta"> ---&gt;</span> Running in 5791c022d132</span><br><span class="line">CentOS-8 - AppStream                            969 kB/s | 6.2 MB     00:06    </span><br><span class="line">CentOS-8 - Base                                 950 kB/s | 2.3 MB     00:02    </span><br><span class="line">CentOS-8 - Extras                                11 kB/s | 8.1 kB     00:00    </span><br><span class="line">Dependencies resolved.</span><br><span class="line">================================================================================</span><br><span class="line"> Package             Arch        Version                   Repository      Size</span><br><span class="line">================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> vim-enhanced        x86_64      2:8.0.1763-15.el8         AppStream      1.4 M</span><br><span class="line">Installing dependencies:</span><br><span class="line"> gpm-libs            x86_64      1.20.7-15.el8             AppStream       39 k</span><br><span class="line"> vim-common          x86_64      2:8.0.1763-15.el8         AppStream      6.3 M</span><br><span class="line"> vim-filesystem      noarch      2:8.0.1763-15.el8         AppStream       48 k</span><br><span class="line"> which               x86_64      2.21-12.el8               BaseOS          49 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">================================================================================</span><br><span class="line">Install  5 Packages</span><br><span class="line"></span><br><span class="line">Total download size: 7.8 M</span><br><span class="line">Installed size: 30 M</span><br><span class="line">Downloading Packages:</span><br><span class="line">(1/5): gpm-libs-1.20.7-15.el8.x86_64.rpm        327 kB/s |  39 kB     00:00    </span><br><span class="line">(2/5): vim-filesystem-8.0.1763-15.el8.noarch.rp 827 kB/s |  48 kB     00:00    </span><br><span class="line">(3/5): which-2.21-12.el8.x86_64.rpm             316 kB/s |  49 kB     00:00    </span><br><span class="line">(4/5): vim-enhanced-8.0.1763-15.el8.x86_64.rpm  1.2 MB/s | 1.4 MB     00:01    </span><br><span class="line">(5/5): vim-common-8.0.1763-15.el8.x86_64.rpm    983 kB/s | 6.3 MB     00:06    </span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Total                                           974 kB/s | 7.8 MB     00:08     </span><br><span class="line">warning: /var/cache/dnf/AppStream-02e86d1c976ab532/packages/gpm-libs-1.20.7-15.el8.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID 8483c65d: NOKEY</span><br><span class="line">CentOS-8 - AppStream                            1.6 MB/s | 1.6 kB     00:00    </span><br><span class="line">Importing GPG key 0x8483C65D:</span><br><span class="line"> Userid     : "CentOS (CentOS Official Signing Key) &lt;security@centos.org&gt;"</span><br><span class="line"> Fingerprint: 99DB 70FA E1D7 CE22 7FB6 4882 05B5 55B3 8483 C65D</span><br><span class="line"> From       : /etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">Key imported successfully</span><br><span class="line">Running transaction check</span><br><span class="line">Transaction check succeeded.</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded.</span><br><span class="line">Running transaction</span><br><span class="line">  Preparing        :                                                        1/1 </span><br><span class="line">  Installing       : which-2.21-12.el8.x86_64                               1/5 </span><br><span class="line">  Installing       : vim-filesystem-2:8.0.1763-15.el8.noarch                2/5 </span><br><span class="line">  Installing       : vim-common-2:8.0.1763-15.el8.x86_64                    3/5 </span><br><span class="line">  Installing       : gpm-libs-1.20.7-15.el8.x86_64                          4/5 </span><br><span class="line">  Running scriptlet: gpm-libs-1.20.7-15.el8.x86_64                          4/5 </span><br><span class="line">  Installing       : vim-enhanced-2:8.0.1763-15.el8.x86_64                  5/5 </span><br><span class="line">  Running scriptlet: vim-enhanced-2:8.0.1763-15.el8.x86_64                  5/5 </span><br><span class="line">  Running scriptlet: vim-common-2:8.0.1763-15.el8.x86_64                    5/5 </span><br><span class="line">  Verifying        : gpm-libs-1.20.7-15.el8.x86_64                          1/5 </span><br><span class="line">  Verifying        : vim-common-2:8.0.1763-15.el8.x86_64                    2/5 </span><br><span class="line">  Verifying        : vim-enhanced-2:8.0.1763-15.el8.x86_64                  3/5 </span><br><span class="line">  Verifying        : vim-filesystem-2:8.0.1763-15.el8.noarch                4/5 </span><br><span class="line">  Verifying        : which-2.21-12.el8.x86_64                               5/5 </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  gpm-libs-1.20.7-15.el8.x86_64         vim-common-2:8.0.1763-15.el8.x86_64    </span><br><span class="line">  vim-enhanced-2:8.0.1763-15.el8.x86_64 vim-filesystem-2:8.0.1763-15.el8.noarch</span><br><span class="line">  which-2.21-12.el8.x86_64             </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">Removing intermediate container 5791c022d132</span><br><span class="line"><span class="meta"> ---&gt;</span> 05dc9bde286e</span><br><span class="line">Step 6/10 : RUN yum -y install net-tools</span><br><span class="line"><span class="meta"> ---&gt;</span> Running in 900fc6c0b10e</span><br><span class="line">Last metadata expiration check: 0:00:15 ago on Thu Dec 10 15:07:33 2020.</span><br><span class="line">Dependencies resolved.</span><br><span class="line">================================================================================</span><br><span class="line"> Package         Architecture Version                        Repository    Size</span><br><span class="line">================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> net-tools       x86_64       2.0-0.52.20160912git.el8       BaseOS       322 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">================================================================================</span><br><span class="line">Install  1 Package</span><br><span class="line"></span><br><span class="line">Total download size: 322 k</span><br><span class="line">Installed size: 942 k</span><br><span class="line">Downloading Packages:</span><br><span class="line">net-tools-2.0-0.52.20160912git.el8.x86_64.rpm   969 kB/s | 322 kB     00:00    </span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Total                                           181 kB/s | 322 kB     00:01     </span><br><span class="line">Running transaction check</span><br><span class="line">Transaction check succeeded.</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded.</span><br><span class="line">Running transaction</span><br><span class="line">  Preparing        :                                                        1/1 </span><br><span class="line">  Installing       : net-tools-2.0-0.52.20160912git.el8.x86_64              1/1 </span><br><span class="line">  Running scriptlet: net-tools-2.0-0.52.20160912git.el8.x86_64              1/1 </span><br><span class="line">  Verifying        : net-tools-2.0-0.52.20160912git.el8.x86_64              1/1 </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  net-tools-2.0-0.52.20160912git.el8.x86_64                                     </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">Removing intermediate container 900fc6c0b10e</span><br><span class="line"><span class="meta"> ---&gt;</span> 3f8796ecbdea</span><br><span class="line">Step 7/10 : EXPOSE 80</span><br><span class="line"><span class="meta"> ---&gt;</span> Running in 37e6f3792548</span><br><span class="line">Removing intermediate container 37e6f3792548</span><br><span class="line"><span class="meta"> ---&gt;</span> 2d37cf00b36b</span><br><span class="line">Step 8/10 : CMD echo $MYPATH</span><br><span class="line"><span class="meta"> ---&gt;</span> Running in 7e4ff55e4b24</span><br><span class="line">Removing intermediate container 7e4ff55e4b24</span><br><span class="line"><span class="meta"> ---&gt;</span> d74bce644e74</span><br><span class="line">Step 9/10 : CMD echo "----end----"</span><br><span class="line"><span class="meta"> ---&gt;</span> Running in fc3301142b73</span><br><span class="line">Removing intermediate container fc3301142b73</span><br><span class="line"><span class="meta"> ---&gt;</span> 2c7e307a481c</span><br><span class="line">Step 10/10 : CMD /bin/bash</span><br><span class="line"><span class="meta"> ---&gt;</span> Running in 4e5c6edd147c</span><br><span class="line">Removing intermediate container 4e5c6edd147c</span><br><span class="line"><span class="meta"> ---&gt;</span> 071c7fb7d0f9</span><br><span class="line">Successfully built 071c7fb7d0f9</span><br><span class="line">Successfully tagged mycentos:0.1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>3.测试镜像</span><br><span class="line">[root@VM-0-15-centos dockerfile]# docker run -it mycentos:0.1</span><br><span class="line">[root@5b68abc14a5a local]# pwd</span><br><span class="line">/usr/local</span><br><span class="line">[root@5b68abc14a5a local]# vim</span><br><span class="line"></span><br><span class="line">sh: wq: command not found</span><br><span class="line"></span><br><span class="line">shell returned 127</span><br><span class="line"></span><br><span class="line">Press ENTER or type command to continue</span><br><span class="line">sh: wq: command not found</span><br><span class="line"></span><br><span class="line">shell returned 127</span><br><span class="line"></span><br><span class="line">Press ENTER or type command to continue</span><br></pre></td></tr></table></figure>
<p>镜像构建历史查看</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@VM-0-15-centos dockerfile]# docker history 071c7fb7d0f9</span><br><span class="line">IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT</span><br><span class="line">071c7fb7d0f9        6 minutes ago       /bin/sh -c #(nop)  CMD ["/bin/sh" "-c" "/bin…   0B                  </span><br><span class="line">2c7e307a481c        6 minutes ago       /bin/sh -c #(nop)  CMD ["/bin/sh" "-c" "echo…   0B                  </span><br><span class="line">d74bce644e74        6 minutes ago       /bin/sh -c #(nop)  CMD ["/bin/sh" "-c" "echo…   0B                  </span><br><span class="line">2d37cf00b36b        6 minutes ago       /bin/sh -c #(nop)  EXPOSE 80                    0B                  </span><br><span class="line">3f8796ecbdea        6 minutes ago       /bin/sh -c yum -y install net-tools             23.1MB              </span><br><span class="line">05dc9bde286e        6 minutes ago       /bin/sh -c yum -y install vim                   57.7MB              </span><br><span class="line">3ed5689097b4        7 minutes ago       /bin/sh -c #(nop) WORKDIR /usr/local            0B                  </span><br><span class="line">b67dab755631        7 minutes ago       /bin/sh -c #(nop)  ENV MYPATH=/usr/local        0B                  </span><br><span class="line">e56a7b5f722b        7 minutes ago       /bin/sh -c #(nop)  MAINTAINER kuangshen&lt;1790…   0B                  </span><br><span class="line">0d120b6ccaa8        4 months ago        /bin/sh -c #(nop)  CMD ["/bin/bash"]            0B                  </span><br><span class="line">&lt;missing&gt;           4 months ago        /bin/sh -c #(nop)  LABEL org.label-schema.sc…   0B                  </span><br><span class="line">&lt;missing&gt;           4 months ago        /bin/sh -c #(nop) ADD file:538afc0c5c964ce0d…   215MB</span><br></pre></td></tr></table></figure>
<h2 id="实战：Dockerfile制作tomcat镜像"><a href="#实战：Dockerfile制作tomcat镜像" class="headerlink" title="实战：Dockerfile制作tomcat镜像"></a>实战：Dockerfile制作tomcat镜像</h2><p>1、准备镜像文件tomcat压缩包，jdk的压缩包！<br>2、编写dockerfile文件。</p>
<h2 id="Docker0网络详解"><a href="#Docker0网络详解" class="headerlink" title="Docker0网络详解"></a>Docker0网络详解</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span>删除所有镜像</span><br><span class="line">[root@VM-0-15-centos ~]# docker rmi -f $(docker images -aq)</span><br><span class="line">Untagged: rxk/centos:latest</span><br><span class="line">Deleted: sha256:7735159af50c4ff09863f0a97c37447043ac0eca6657913a4e33c65b0be4a24d</span><br><span class="line">Deleted: sha256:d64085501c38257f9828c1dc9717f26e20df9bcb8d1b958b7f49ea5bb0425ae0</span><br><span class="line">Deleted: sha256:02a6fde9ba357c11d75c6d828c8fee80e1e5e77c4aedb3a83c7e302fc1745d40</span><br><span class="line">Untagged: tomcat02:1.0</span><br><span class="line">Deleted: sha256:80b6126c75b93053ee013c1a724a10fb958ddab21e5b0f3f10a58dbb996c74eb</span><br><span class="line">Deleted: sha256:20e9e09986f8d937efa6f2ad283aa9a1b837cc5cc5d4d76e6105f83e38e8f3de</span><br><span class="line">Untagged: nginx:latest</span><br><span class="line">Untagged: nginx@sha256:6b1daa9462046581ac15be20277a7c75476283f969cb3a61c8725ec38d3b01c3</span><br><span class="line">Deleted: sha256:bc9a0695f5712dcaaa09a5adc415a3936ccba13fc2587dfd76b1b8aeea3f221c</span><br><span class="line">Untagged: mysql:5.7</span><br><span class="line">Untagged: mysql@sha256:8e2004f9fe43df06c3030090f593021a5f283d028b5ed5765cc24236c2c4d88e</span><br><span class="line">Deleted: sha256:ae0658fdbad5fb1c9413c998d8a573eeb5d16713463992005029c591e6400d02</span><br><span class="line">Untagged: tomcat:9.0</span><br><span class="line">Untagged: tomcat:latest</span><br><span class="line">Untagged: tomcat@sha256:a319b10d8729817c7ce0bcc2343a6f97711c7870395019340d96b6aafd6ccbea</span><br><span class="line">Deleted: sha256:e0bd8b34b4ea904874e55eae50e8987815030d140f9773a4b61759f4f85bf38d</span><br><span class="line">Untagged: portainer/portainer:latest</span><br><span class="line">Untagged: portainer/portainer@sha256:f8c2b0a9ca640edf508a8a0830cf1963a1e0d2fd9936a64104b3f658e120b868</span><br><span class="line">Deleted: sha256:62771b0b9b0973a3e8e95595534a1240d8cfd968d30ec82dc0393ce0a256c5f3</span><br><span class="line">Untagged: elasticsearch:7.6.2</span><br><span class="line">Untagged: elasticsearch@sha256:1b09dbd93085a1e7bca34830e77d2981521a7210e11f11eda997add1c12711fa</span><br><span class="line">Deleted: sha256:f29a1ee41030e3963026369105f3bee76d75fdecbeca07932ac054126be7bff9</span><br><span class="line">Error response from daemon: conflict: unable to delete 071c7fb7d0f9 (cannot be forced) - image is being used by running container 5b68abc14a5a</span><br><span class="line">Error response from daemon: conflict: unable to delete 3f8796ecbdea (cannot be forced) - image has dependent child images</span><br><span class="line">Error response from daemon: conflict: unable to delete d74bce644e74 (cannot be forced) - image has dependent child images</span><br><span class="line">Error response from daemon: conflict: unable to delete 2d37cf00b36b (cannot be forced) - image has dependent child images</span><br><span class="line">Error response from daemon: conflict: unable to delete 2c7e307a481c (cannot be forced) - image has dependent child images</span><br><span class="line">Error response from daemon: conflict: unable to delete 05dc9bde286e (cannot be forced) - image has dependent child images</span><br><span class="line">Error response from daemon: conflict: unable to delete 3ed5689097b4 (cannot be forced) - image has dependent child images</span><br><span class="line">Error response from daemon: conflict: unable to delete e56a7b5f722b (cannot be forced) - image has dependent child images</span><br><span class="line">Error response from daemon: conflict: unable to delete b67dab755631 (cannot be forced) - image has dependent child images</span><br><span class="line">Error: No such image: 02a6fde9ba35</span><br><span class="line">Error: No such image: d64085501c38</span><br><span class="line">Error: No such image: e0bd8b34b4ea</span><br><span class="line">Error response from daemon: conflict: unable to delete 0d120b6ccaa8 (cannot be forced) - image has dependent child images</span><br></pre></td></tr></table></figure>
<p>三个网络<br><img src="https://note.youdao.com/yws/public/resource/73aee03bab25dda63f8e72a1f2ebbfd7/301B5C7AFEDF440AB66F2E247F1722FE?ynotemdtimestamp=1608628058165" alt="image"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span>启动一个tomcat</span><br><span class="line">[root@VM-0-15-centos ~]# docker run -d -P --name tomcat02 tomcat</span><br><span class="line">942539fdda0c018ffa3750661373e624c4f2226f5d9532323d5c42c1daea98db</span><br><span class="line">[root@VM-0-15-centos ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                     NAMES</span><br><span class="line">942539fdda0c        tomcat              "catalina.sh run"   3 seconds ago       Up 3 seconds        0.0.0.0:32768-&gt;8080/tcp   tomcat02</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>查看容器的内部网络地址</span><br><span class="line">[root@VM-0-15-centos ~]# docker exec -it tomcat02 ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">112: eth0@if113: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:ac:12:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.18.0.2/16 brd 172.18.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>
<p>linux可以ping通docker容器内部</p>
<blockquote>
<p>原理</p>
</blockquote>
<p>1.我们每安装一个docker容器，docker就会给docker容器分配一个ip，我们只要安装了docker，就会有一个网卡，docker0，使用桥接模式，使用技术是veth-pair技术！</p>
<p>再次测试ip addr:</p>
<p><img src="https://note.youdao.com/yws/public/resource/73aee03bab25dda63f8e72a1f2ebbfd7/E21656EE36124DF3AE9BDC6C35DFC3D6?ynotemdtimestamp=1608628058165" alt="image"></p>
<p>2.再启动一个容器测试，又会多一对网卡，这样一对对的网卡，其实是veth-pair技术，就是一对的虚拟设备，他们都是成对出现，一段连着协议，一段彼此相连，veth-pair充当一个桥梁，链接各种虚拟网络设备<br><img src="https://note.youdao.com/yws/public/resource/73aee03bab25dda63f8e72a1f2ebbfd7/921AD106BB7A4C77993BC1B841382F97?ynotemdtimestamp=1608628058165" alt="image"></p>
<p>3.测试下tomcat02和tomcat03能否ping通，确实可以ping通</p>
<p><strong>容器和容器之间是可以互相ping通的</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@VM-0-15-centos ~]# docker exec -it tomcat03 ping 172.18.0.2</span><br><span class="line">PING 172.18.0.2 (172.18.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.18.0.2: icmp_seq=1 ttl=64 time=0.076 ms</span><br><span class="line">64 bytes from 172.18.0.2: icmp_seq=2 ttl=64 time=0.054 ms</span><br><span class="line">64 bytes from 172.18.0.2: icmp_seq=3 ttl=64 time=0.053 ms</span><br><span class="line">^C</span><br><span class="line">--- 172.18.0.2 ping statistics ---</span><br><span class="line">3 packets transmitted, 3 received, 0% packet loss, time 1001ms</span><br><span class="line">rtt min/avg/max/mdev = 0.053/0.061/0.076/0.010 ms</span><br></pre></td></tr></table></figure>
<p><strong>结论：tomcat02和tomcat03共用一个路由器，docker0</strong></p>
<p>所有容器不指定网络的情况下，都是由docker0路由的，docker会给我们容器分配一个默认的可用IP</p>
<p>当把docker容器删除之后，ip addr之后 容器ip就没了</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@VM-0-15-centos ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                     NAMES</span><br><span class="line">be137857cf4e        tomcat              "catalina.sh run"   29 minutes ago      Up 29 minutes       0.0.0.0:32769-&gt;8080/tcp   tomcat03</span><br><span class="line">942539fdda0c        tomcat              "catalina.sh run"   37 minutes ago      Up 37 minutes       0.0.0.0:32768-&gt;8080/tcp   tomcat02</span><br><span class="line">[root@VM-0-15-centos ~]# docker rm -f be137857cf4e</span><br><span class="line">be137857cf4e</span><br><span class="line">[root@VM-0-15-centos ~]# docker rm -f 942539fdda0c</span><br><span class="line">942539fdda0c</span><br><span class="line">[root@VM-0-15-centos ~]# ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 52:54:00:83:af:57 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.15/20 brd 172.17.15.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::5054:ff:fe83:af57/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default </span><br><span class="line">    link/ether 02:42:18:37:f9:06 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.18.0.1/16 brd 172.18.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:18ff:fe37:f906/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>
<h2 id="Docker-–link-容器互联"><a href="#Docker-–link-容器互联" class="headerlink" title="Docker –link 容器互联"></a>Docker –link 容器互联</h2><p>使用服务名去ping通tomcat</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -d -P tomcat03 --link tomcat02 tomcat</span><br><span class="line"></span><br><span class="line">docker exec -it tomcat03 ping tomcat02</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>此时3能ping 通2，但是2 ping不通3</span><br></pre></td></tr></table></figure>
<h2 id="Docker自定义网络"><a href="#Docker自定义网络" class="headerlink" title="Docker自定义网络"></a>Docker自定义网络</h2><p>查看docker所有网络</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@VM-0-15-centos ~]# docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">df77c62f6661        bridge              bridge              local</span><br><span class="line">c916a7eaedff        host                host                local</span><br><span class="line">00b73cedd526        none                null                local</span><br></pre></td></tr></table></figure>
<p><strong>网络模式</strong></p>
<p>bridge:桥接 bridge(默认)</p>
<p>none:不配置网络</p>
<p>host:和宿主机共享网络</p>
<p>container:容器内网络连通(使用较少)</p>
<p>创建自己的自定义网络</p>
<p>–driver bridge 默认桥接</p>
<p>–subnet 192.168.0.0/16 子网地址</p>
<p>–gateway 192.168.0.1 网关地址</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@VM-0-15-centos ~]# docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet</span><br><span class="line"></span><br><span class="line">[root@VM-0-15-centos ~]# docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">df77c62f6661        bridge              bridge              local</span><br><span class="line">c916a7eaedff        host                host                local</span><br><span class="line">f5100a69756f        mynet               bridge              local</span><br><span class="line">00b73cedd526        none                null                local</span><br><span class="line"></span><br><span class="line">[root@VM-0-15-centos ~]# docker network inspect mynet</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        "Name": "mynet",</span><br><span class="line">        "Id": "f5100a69756fbedf28ab9ad7ecbf354417328efc06d7f0bfae40a0d4c7d33de4",</span><br><span class="line">        "Created": "2020-12-22T11:03:05.693800981+08:00",</span><br><span class="line">        "Scope": "local",</span><br><span class="line">        "Driver": "bridge",</span><br><span class="line">        "EnableIPv6": false,</span><br><span class="line">        "IPAM": &#123;</span><br><span class="line">            "Driver": "default",</span><br><span class="line">            "Options": &#123;&#125;,</span><br><span class="line">            "Config": [</span><br><span class="line">                &#123;</span><br><span class="line">                    "Subnet": "192.168.0.0/16",</span><br><span class="line">                    "Gateway": "192.168.0.1"</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        "Internal": false,</span><br><span class="line">        "Attachable": false,</span><br><span class="line">        "Ingress": false,</span><br><span class="line">        "ConfigFrom": &#123;</span><br><span class="line">            "Network": ""</span><br><span class="line">        &#125;,</span><br><span class="line">        "ConfigOnly": false,</span><br><span class="line">        "Containers": &#123;&#125;,</span><br><span class="line">        "Options": &#123;&#125;,</span><br><span class="line">        "Labels": &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>启动两个容器</span><br><span class="line">[root@VM-0-15-centos ~]# docker run -d -P --name tomcat-net-01 --network mynet tomcat</span><br><span class="line">8fc4551bbad9d836cea86a3feb957596af6e1310781eadee1baacbb177d84a33</span><br><span class="line">[root@VM-0-15-centos ~]# docker run -d -P --name tomcat-net-02 --network mynet tomcat</span><br><span class="line">01a3d2a47af6a79689dc85e0a110d576cbdfa8bb979d25d7f493b13157b3e26a</span><br><span class="line">[root@VM-0-15-centos ~]# docker network inspect mynet</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        "Name": "mynet",</span><br><span class="line">        "Id": "f5100a69756fbedf28ab9ad7ecbf354417328efc06d7f0bfae40a0d4c7d33de4",</span><br><span class="line">        "Created": "2020-12-22T11:03:05.693800981+08:00",</span><br><span class="line">        "Scope": "local",</span><br><span class="line">        "Driver": "bridge",</span><br><span class="line">        "EnableIPv6": false,</span><br><span class="line">        "IPAM": &#123;</span><br><span class="line">            "Driver": "default",</span><br><span class="line">            "Options": &#123;&#125;,</span><br><span class="line">            "Config": [</span><br><span class="line">                &#123;</span><br><span class="line">                    "Subnet": "192.168.0.0/16",</span><br><span class="line">                    "Gateway": "192.168.0.1"</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        "Internal": false,</span><br><span class="line">        "Attachable": false,</span><br><span class="line">        "Ingress": false,</span><br><span class="line">        "ConfigFrom": &#123;</span><br><span class="line">            "Network": ""</span><br><span class="line">        &#125;,</span><br><span class="line">        "ConfigOnly": false,</span><br><span class="line">        "Containers": &#123;</span><br><span class="line">            "01a3d2a47af6a79689dc85e0a110d576cbdfa8bb979d25d7f493b13157b3e26a": &#123;</span><br><span class="line">                "Name": "tomcat-net-02",</span><br><span class="line">                "EndpointID": "25be3c90c1e1a4b74f5fc9e10a59c50029ca7ff3bf692d7de636738edb3457b3",</span><br><span class="line">                "MacAddress": "02:42:c0:a8:00:03",</span><br><span class="line">                "IPv4Address": "192.168.0.3/16",</span><br><span class="line">                "IPv6Address": ""</span><br><span class="line">            &#125;,</span><br><span class="line">            "8fc4551bbad9d836cea86a3feb957596af6e1310781eadee1baacbb177d84a33": &#123;</span><br><span class="line">                "Name": "tomcat-net-01",</span><br><span class="line">                "EndpointID": "a83c09df1a4595735453dafdde352123dd024707400716fbab256c7e3c02ea4a",</span><br><span class="line">                "MacAddress": "02:42:c0:a8:00:02",</span><br><span class="line">                "IPv4Address": "192.168.0.2/16",</span><br><span class="line">                "IPv6Address": ""</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        "Options": &#123;&#125;,</span><br><span class="line">        "Labels": &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>再次测试，不再使用--link 也是可以连接通的，不管使用ip还是服务名</span><br><span class="line">[root@VM-0-15-centos ~]# docker exec -it tomcat-net-01 ping 192.168.0.3</span><br><span class="line">PING 192.168.0.3 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.0.3: icmp_seq=1 ttl=64 time=0.085 ms</span><br><span class="line">64 bytes from 192.168.0.3: icmp_seq=2 ttl=64 time=0.055 ms</span><br><span class="line">64 bytes from 192.168.0.3: icmp_seq=3 ttl=64 time=0.053 ms</span><br><span class="line">^C</span><br><span class="line">--- 192.168.0.3 ping statistics ---</span><br><span class="line">3 packets transmitted, 3 received, 0% packet loss, time 1000ms</span><br><span class="line">rtt min/avg/max/mdev = 0.053/0.064/0.085/0.016 ms</span><br><span class="line">[root@VM-0-15-centos ~]# docker exec -it tomcat-net-01 ping tomcat-net-02</span><br><span class="line">PING tomcat-net-02 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=1 ttl=64 time=0.050 ms</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=2 ttl=64 time=0.052 ms</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=3 ttl=64 time=0.053 ms</span><br><span class="line">^C</span><br><span class="line">--- tomcat-net-02 ping statistics ---</span><br><span class="line">3 packets transmitted, 3 received, 0% packet loss, time 2ms</span><br><span class="line">rtt min/avg/max/mdev = 0.050/0.051/0.053/0.008 ms</span><br></pre></td></tr></table></figure>
<p><strong>我们自定义的网络docker 都已经帮我们维护好了对应的关系，推荐这样使用网络！</strong></p>
<p>好处：<br>不同的集群使用不同的网络，保证集群是安全和健康</p>
<h2 id="网络连通"><a href="#网络连通" class="headerlink" title="网络连通"></a>网络连通</h2><p>把一个容器连接到网络上</p>
<p>#将tomcat01连接到mynet网络下，一个容器两个ip</p>
<p>docker network connect mynet tomcat01 </p>
<h2 id="Redis集群实战"><a href="#Redis集群实战" class="headerlink" title="Redis集群实战"></a>Redis集群实战</h2><p>通过脚本创建六个redis配置</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">for port in $(seq 1 6); \</span><br><span class="line">do \</span><br><span class="line">mkdir -p /mydata/redis/node-$&#123;port&#125;/conf</span><br><span class="line">touch /mydata/redis/node-$&#123;port&#125;/conf/redis.conf</span><br><span class="line">cat &lt;&lt; EOF &gt;/mydata/redis/node-$&#123;port&#125;/conf/redis.conf</span><br><span class="line">port 6379</span><br><span class="line">bind 0.0.0.0</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">cluster-announce-ip 172.38.0.1$&#123;port&#125;</span><br><span class="line">cluster-announce-port 6379</span><br><span class="line">cluster-announce-bus-port 16379</span><br><span class="line">daemonize no</span><br><span class="line">appendonly yes</span><br><span class="line">EOF</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p>启动redis</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -p 6371:6379 -p 16371:16379 --name redis-1 -v /mydata/redis/node-1/data:/data -v /mydata/redis/node-1/conf/redis.conf:/etc/redis/redis.conf -d --net redis --ip 172.38.0.11 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker run -p 6372:6379 -p 16372:16379 --name redis-2 -v /mydata/redis/node-2/data:/data -v /mydata/redis/node-2/conf/redis.conf:/etc/redis/redis.conf -d --net redis --ip 172.38.0.12 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker run -p 6373:6379 -p 16373:16379 --name redis-3 -v /mydata/redis/node-3/data:/data -v /mydata/redis/node-3/conf/redis.conf:/etc/redis/redis.conf -d --net redis --ip 172.38.0.13 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line">docker run -p 6374:6379 -p 16374:16379 --name redis-4 -v /mydata/redis/node-4/data:/data -v /mydata/redis/node-4/conf/redis.conf:/etc/redis/redis.conf -d --net redis --ip 172.38.0.14 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker run -p 6375:6379 -p 16375:16379 --name redis-5 -v /mydata/redis/node-5/data:/data -v /mydata/redis/node-5/conf/redis.conf:/etc/redis/redis.conf -d --net redis --ip 172.38.0.15 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line">docker run -p 6376:6379 -p 16376:16379 --name redis-6 -v /mydata/redis/node-6/data:/data -v /mydata/redis/node-6/conf/redis.conf:/etc/redis/redis.conf -d --net redis --ip 172.38.0.16 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>正常启动之后</span><br><span class="line">[root@VM-0-15-centos ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE                    COMMAND                  CREATED              STATUS              PORTS                                              NAMES</span><br><span class="line">e1535aac14ce        redis:5.0.9-alpine3.11   "docker-entrypoint.s…"   22 seconds ago       Up 22 seconds       0.0.0.0:6376-&gt;6379/tcp, 0.0.0.0:16376-&gt;16379/tcp   redis-6</span><br><span class="line">fcf18ac7033d        redis:5.0.9-alpine3.11   "docker-entrypoint.s…"   31 seconds ago       Up 30 seconds       0.0.0.0:6375-&gt;6379/tcp, 0.0.0.0:16375-&gt;16379/tcp   redis-5</span><br><span class="line">b17f66d41588        redis:5.0.9-alpine3.11   "docker-entrypoint.s…"   37 seconds ago       Up 37 seconds       0.0.0.0:6374-&gt;6379/tcp, 0.0.0.0:16374-&gt;16379/tcp   redis-4</span><br><span class="line">afb2f4e6484e        redis:5.0.9-alpine3.11   "docker-entrypoint.s…"   44 seconds ago       Up 44 seconds       0.0.0.0:6373-&gt;6379/tcp, 0.0.0.0:16373-&gt;16379/tcp   redis-3</span><br><span class="line">ef59db5b0cc0        redis:5.0.9-alpine3.11   "docker-entrypoint.s…"   54 seconds ago       Up 53 seconds       0.0.0.0:6372-&gt;6379/tcp, 0.0.0.0:16372-&gt;16379/tcp   redis-2</span><br><span class="line">0eca360704d7        redis:5.0.9-alpine3.11   "docker-entrypoint.s…"   About a minute ago   Up About a minute   0.0.0.0:6371-&gt;6379/tcp, 0.0.0.0:16371-&gt;16379/tcp   redis-1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>进入redis-1</span><br><span class="line">[root@VM-0-15-centos ~]# docker exec -it redis-1 /bin/sh</span><br><span class="line">/data # </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>创建redis集群</span><br><span class="line">[root@VM-0-15-centos ~]# docker exec -it redis-1 /bin/sh</span><br><span class="line">/data # redis-cli --cluster create 172.38.0.11:6379 172.38.0.12:6379 172.38.0.13:6379 172.38.0.14:6379 </span><br><span class="line">172.38.0.15:6379 172.38.0.16:6379 --cluster-replicas 1</span><br><span class="line"><span class="meta">&gt;</span>&gt;&gt; Performing hash slots allocation on 6 nodes...</span><br><span class="line">Master[0] -&gt; Slots 0 - 5460</span><br><span class="line">Master[1] -&gt; Slots 5461 - 10922</span><br><span class="line">Master[2] -&gt; Slots 10923 - 16383</span><br><span class="line">Adding replica 172.38.0.15:6379 to 172.38.0.11:6379</span><br><span class="line">Adding replica 172.38.0.16:6379 to 172.38.0.12:6379</span><br><span class="line">Adding replica 172.38.0.14:6379 to 172.38.0.13:6379</span><br><span class="line">M: f70e64b741bad779e2b545b1429b47b2732a9a13 172.38.0.11:6379</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">M: de19aadcb9d25a77ca0e5a23f1c45f31a6ece84d 172.38.0.12:6379</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">M: 43b45750adfaea90314c724dd1b800621f6b40bf 172.38.0.13:6379</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">S: 13b65b47fcac7126bf6ca15a322037571c90464f 172.38.0.14:6379</span><br><span class="line">   replicates 43b45750adfaea90314c724dd1b800621f6b40bf</span><br><span class="line">S: 03e58c163b80baf32990d6faf3a104d97e14f1e4 172.38.0.15:6379</span><br><span class="line">   replicates f70e64b741bad779e2b545b1429b47b2732a9a13</span><br><span class="line">S: b80d23b1516da408f9f9bad22007ce4389e529ca 172.38.0.16:6379</span><br><span class="line">   replicates de19aadcb9d25a77ca0e5a23f1c45f31a6ece84d</span><br><span class="line">Can I set the above configuration? (type 'yes' to accept): yes</span><br><span class="line"><span class="meta">&gt;</span>&gt;&gt; Nodes configuration updated</span><br><span class="line"><span class="meta">&gt;</span>&gt;&gt; Assign a different config epoch to each node</span><br><span class="line"><span class="meta">&gt;</span>&gt;&gt; Sending CLUSTER MEET messages to join the cluster</span><br><span class="line">Waiting for the cluster to join</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;</span>&gt;&gt; Performing Cluster Check (using node 172.38.0.11:6379)</span><br><span class="line">M: f70e64b741bad779e2b545b1429b47b2732a9a13 172.38.0.11:6379</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: de19aadcb9d25a77ca0e5a23f1c45f31a6ece84d 172.38.0.12:6379</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 13b65b47fcac7126bf6ca15a322037571c90464f 172.38.0.14:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 43b45750adfaea90314c724dd1b800621f6b40bf</span><br><span class="line">S: 03e58c163b80baf32990d6faf3a104d97e14f1e4 172.38.0.15:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates f70e64b741bad779e2b545b1429b47b2732a9a13</span><br><span class="line">M: 43b45750adfaea90314c724dd1b800621f6b40bf 172.38.0.13:6379</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: b80d23b1516da408f9f9bad22007ce4389e529ca 172.38.0.16:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates de19aadcb9d25a77ca0e5a23f1c45f31a6ece84d</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line"><span class="meta">&gt;</span>&gt;&gt; Check for open slots...</span><br><span class="line"><span class="meta">&gt;</span>&gt;&gt; Check slots coverage...</span><br><span class="line">[OK] All 16384 slots covered.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/data # redis-cli -c</span><br><span class="line">127.0.0.1:6379&gt; cluster info</span><br><span class="line">cluster_state:ok</span><br><span class="line">cluster_slots_assigned:16384</span><br><span class="line">cluster_slots_ok:16384</span><br><span class="line">cluster_slots_pfail:0</span><br><span class="line">cluster_slots_fail:0</span><br><span class="line">cluster_known_nodes:6</span><br><span class="line">cluster_size:3</span><br><span class="line">cluster_current_epoch:6</span><br><span class="line">cluster_my_epoch:1</span><br><span class="line">cluster_stats_messages_ping_sent:149</span><br><span class="line">cluster_stats_messages_pong_sent:140</span><br><span class="line">cluster_stats_messages_sent:289</span><br><span class="line">cluster_stats_messages_ping_received:135</span><br><span class="line">cluster_stats_messages_pong_received:149</span><br><span class="line">cluster_stats_messages_meet_received:5</span><br><span class="line">cluster_stats_messages_received:289</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; cluster nodes</span><br><span class="line">de19aadcb9d25a77ca0e5a23f1c45f31a6ece84d 172.38.0.12:6379@16379 master - 0 1608624786213 2 conn61-10922</span><br><span class="line">13b65b47fcac7126bf6ca15a322037571c90464f 172.38.0.14:6379@16379 slave 43b45750adfaea90314c724ddf6b40bf 0 1608624785000 4 connected</span><br><span class="line">03e58c163b80baf32990d6faf3a104d97e14f1e4 172.38.0.15:6379@16379 slave f70e64b741bad779e2b545b1432a9a13 0 1608624785000 5 connected</span><br><span class="line">43b45750adfaea90314c724dd1b800621f6b40bf 172.38.0.13:6379@16379 master - 0 1608624785210 3 conn923-16383</span><br><span class="line">b80d23b1516da408f9f9bad22007ce4389e529ca 172.38.0.16:6379@16379 slave de19aadcb9d25a77ca0e5a23f6ece84d 0 1608624785712 6 connected</span><br><span class="line">f70e64b741bad779e2b545b1429b47b2732a9a13 172.38.0.11:6379@16379 myself,master - 0 1608624785000cted 0-5460</span><br><span class="line">127.0.0.1:6379&gt; set a b</span><br><span class="line"><span class="meta">-&gt;</span> Redirected to slot [15495] located at 172.38.0.13:6379</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">172.38.0.13:6379&gt; get a</span><br><span class="line">^C</span><br><span class="line"><span class="meta">#</span>即使把redis-3 stop了，仍然可以通过其他slaver找到key a所对应的值b，主从配置成功</span><br><span class="line">/data # redis-cli -c</span><br><span class="line">127.0.0.1:6379&gt; get a</span><br><span class="line"><span class="meta">-&gt;</span> Redirected to slot [15495] located at 172.38.0.14:6379</span><br><span class="line">"b"</span><br><span class="line">172.38.0.14:6379&gt;</span><br></pre></td></tr></table></figure>
<p>搭建redis集群完成</p>
<p><img src="https://note.youdao.com/yws/public/resource/73aee03bab25dda63f8e72a1f2ebbfd7/0EBCAFD3BBCE40EB8793A97A73C8285D?ynotemdtimestamp=1608628058165" alt="image"></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">CinKate</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://renxingkai.github.io/2020/12/01/docker-learning/">http://renxingkai.github.io/2020/12/01/docker-learning/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/docker/">docker</a></div><div class="social-share pull-right" data-disabled="google,facebook"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script><nav id="pagination"><div class="prev-post pull-left"><a href="/2020/12/24/git-learn/"><i class="fa fa-chevron-left">  </i><span>Git常用复习</span></a></div><div class="next-post pull-right"><a href="/2019/05/12/WordEmbeddingsforReadingComprehension/"><span>《A Comparative Study of Word Embeddings for Reading Comprehension》论文阅读</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(http://p17.qhimg.com/d/_open360/fengjing0403/21.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2019 - 2022 By CinKate</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://renxingkai.github.io">blog</a>!</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css"><script src="/js/katex.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>